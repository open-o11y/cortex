<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.72.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Changelog | Cortex</title><meta property="og:title" content="Changelog"><meta property="og:description" content="master / unreleased  [CHANGE] Blocks storage: update the default HTTP configuration values for the S3 client to the upstream Thanos default values. #3244  -blocks-storage.s3.http.idle-conn-timeout is set 90 seconds. -blocks-storage.s3.http.response-header-timeout is set to 2 minutes.   [CHANGE] Improved shuffle sharding support in the write path. This work introduced some config changes: #3090  Introduced -distributor.sharding-strategy CLI flag (and its respective sharding_strategy YAML config option) to explicitly specify which sharding strategy should be used in the write path -experimental."><meta property="og:type" content="article"><meta property="og:url" content="/docs/changelog/"><meta property="og:image" content="/images/logo-twitter-card.jpg"><meta property="og:site_name" content="Cortex"><meta itemprop=name content="Changelog"><meta itemprop=description content="master / unreleased  [CHANGE] Blocks storage: update the default HTTP configuration values for the S3 client to the upstream Thanos default values. #3244  -blocks-storage.s3.http.idle-conn-timeout is set 90 seconds. -blocks-storage.s3.http.response-header-timeout is set to 2 minutes.   [CHANGE] Improved shuffle sharding support in the write path. This work introduced some config changes: #3090  Introduced -distributor.sharding-strategy CLI flag (and its respective sharding_strategy YAML config option) to explicitly specify which sharding strategy should be used in the write path -experimental."><meta itemprop=wordCount content="14146"><meta itemprop=image content="/images/logo-twitter-card.jpg"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/logo-twitter-card.jpg"><meta name=twitter:title content="Changelog"><meta name=twitter:description content="master / unreleased  [CHANGE] Blocks storage: update the default HTTP configuration values for the S3 client to the upstream Thanos default values. #3244  -blocks-storage.s3.http.idle-conn-timeout is set 90 seconds. -blocks-storage.s3.http.response-header-timeout is set to 2 minutes.   [CHANGE] Improved shuffle sharding support in the write path. This work introduced some config changes: #3090  Introduced -distributor.sharding-strategy CLI flag (and its respective sharding_strategy YAML config option) to explicitly specify which sharding strategy should be used in the write path -experimental."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-63872299-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.e90eaa454320b057abaa93e650772218ea4d1e3c83e8c45ecd880c9ee9f60107.css as=style><link href=/scss/main.min.e90eaa454320b057abaa93e650772218ea4d1e3c83e8c45ecd880c9ee9f60107.css rel=stylesheet integrity><link href=/css/offline-search.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.1.6/lunr.js></script><script src=/js/offline-search.js></script><title>Changelog | Cortex</title></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar navbar-nocover"><a id=cortex-logo class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-17.92 -14.92 1191.84 462.84"><defs><style>.cls-1{fill:#fff}</style></defs><path d="M214.531 8.017C99.353 8.017 5.65 101.72 5.65 216.899S99.353 425.78 214.531 425.78s208.882-93.704 208.882-208.882S329.71 8.017 214.531 8.017zm0 408.558c-110.102.0-199.676-89.574-199.676-199.676S104.429 17.222 214.53 17.222 414.208 106.797 414.208 216.9 324.633 416.575 214.53 416.575z" class="cls-1"/><circle cx="327.452" cy="221.633" r="34.571" class="cls-1"/><circle cx="213.713" cy="353.584" r="34.571" class="cls-1"/><path d="M299.992 167.913l-59-56.05a34.578 34.578.0 10-4.343 4.34l57.828 54.937a60.158 60.158.0 00-27.168 49.123h-12.97l-23.456-67.02-26.055 64.718H175.73l-24.724 57.22-21.808-54.524-.063.025v-.586h-22.048a34.582 34.582.0 10-.275 6.138h18.005l25.97 64.925 28.977-67.06h29.207l21.51-53.424 19.503 55.725H267.5a60.173 60.173.0 0025.202 44.11l-56.52 56.52 4.34 4.338 57.492-57.492a60.155 60.155.0 101.977-105.963zm81.481 53.515a54.02 54.02.0 11-54.022-54.02 54.083 54.083.0 0154.022 54.02zm175.707 42.568q-8.797 8.178-24.405 8.177a34.858 34.858.0 01-17.095-3.965 33.188 33.188.0 01-11.643-10.529 46.374 46.374.0 01-6.566-14.99 71.134 71.134.0 01-2.105-17.341 86.99 86.99.0 011.982-18.706 46.804 46.804.0 016.565-15.98 34.028 34.028.0 0112.263-11.149 7.675-4.21 19.077-4.212 13.38.0 21.306 6.69 7.927 6.689 10.405 18.829h21.803a50.76 50.76.0 00-5.946-19.696 44.06 44.06.0 00-12.015-13.75 49.842 49.842.0 00-16.848-8.051 77.44 77.44.0 00-20.44-2.601q-15.114.0-26.509 5.326a52.935 52.935.0 00-18.952 14.617 62.165 62.165.0 00-11.273 21.8 94.013 94.013.0 00-3.717 26.883 86.195 86.195.0 003.84 26.386 57.783 57.783.0 0011.397 20.686 50.138 50.138.0 0018.829 13.38 66.766 66.766.0 0025.891 4.705 24.527.0 38.772-12.882 14.245-12.878 17.715-36.668h-21.556q-1.986 14.867-10.776 23.041zm157.44-87.828a56.338 56.338.0 00-19.447-14.244q-11.52-5.203-26.882-5.203-15.115.0-26.756 5.203a56.009 56.009.0 00-19.573 14.244 59.75 59.75.0 00-11.892 21.307 85.299 85.299.0 00-3.965 26.386 84.117 84.117.0 003.965 26.262 59.853 59.853.0 0011.892 21.183 54.61 54.61.0 0019.573 14.12 11.643 5.077 26.756 5.08 15.36.0 26.882-5.08a54.908 54.908.0 0019.447-14.12 59.95 59.95.0 0011.892-21.183 84.181 84.181.0 003.965-26.262 85.364 85.364.0 00-3.965-26.386 59.846 59.846.0 00-11.892-21.307zm-9.538 68.38a43.305 43.305.0 01-8.548 15.113 37.061 37.061.0 01-12.759 9.29 38.825 38.825.0 01-30.968.0 37.003 37.003.0 01-12.76-9.29 43.209 43.209.0 01-8.547-15.114 70.669 70.669.0 010-41.373 44.634 44.634.0 018.547-15.237 36.428 36.428.0 0112.76-9.415 38.826 38.826.0 0130.968.0 36.484 36.484.0 0112.76 9.415 44.735 44.735.0 018.547 15.237 70.624 70.624.0 010 41.373zm81.141-80.89q-11.147 7.434-18.83 23.041h-.493v-27.005h-19.82V287.78h21.057v-56.984a87.528 87.528.0 012.478-21.924 41.993 41.993.0 017.93-16.228 33.951 33.951.0 0114.368-10.158q8.919-3.468 21.555-3.468V156.72q-17.097-.493-28.245 6.937zm80.761-42.366h-21.06v38.402h-21.8v18.581h21.8v81.51a48.668 48.668.0 001.734 14.37 17.432 17.432.0 005.326 8.423 20.57 20.57.0 009.415 4.088 75.59 75.59.0 0013.999 1.115h16.104v-18.582h-9.664a70.335 70.335.0 01-8.05-.37 10.361 10.361.0 01-4.833-1.611 6.108 6.108.0 01-2.354-3.469 23.006 23.006.0 01-.617-5.946v-79.528h25.518v-18.581h-25.518zm148.522 60.452a56.135 56.135.0 00-18.085-17.962q-11.276-7.063-28.367-7.06a58.263 58.263.0 00-24.155 4.953 56.796 56.796.0 00-19.079 13.875 63.949 63.949.0 00-12.51 21.058 77.064 77.064.0 00-4.461 26.758 102.521 102.521.0 004.338 27.004 58.87 58.87.0 0011.519 21.307 52.43 52.43.0 0018.953 13.873 11.272 4.954 26.632 4.955 21.8.0 36.173-10.901 14.364-10.898 18.58-32.455h-20.81q-2.73 12.635-11.272 18.829-8.549 6.198-21.927 6.195a43.577 43.577.0 01-18.085-3.468 35.417 35.417.0 01-12.636-9.291 36.127 36.127.0 01-7.184-13.38 50.746 50.746.0 01-1.981-15.98h95.879a102.07 102.07.0 00-2.107-24.526 71.064 71.064.0 00-9.415-23.784zm-84.357 29.73a43.81 43.81.0 013.219-13.999 37.354 37.354.0 0034.013 34.013.0 111.272-7.803 000 114.74-2.85 36.062 36.062 002.85 36.492 36.492.0 111.398 0036.107.0 17.68 11.52 43.253 0013.345 14.122zm170.95 7.184 44.1-58.964h-25.271l-31.961 44.843-30.721-44.843h-27.006l44.595 60.698-48.063 67.389h25.518l35.677-53.019 35.676 53.019h27.006l-49.55-69.123z" class="cls-1"/></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://twitter.com/cortexmetrics class="nav-link active"><span class=active><i class="fab fa-fw fa-twitter"></i>Twitter</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://github.com/cortexproject class="nav-link active"><span class=active><i class="fab fa-fw fa-github"></i>Github</span></a></li></ul></div><div class="navbar-nav d-none d-md-block"><div id=search-nav-container><input type=search id=search-input autocomplete=off class="form-control td-search-input" placeholder="&#xf002 Search this site…" autocomplete=on><div id=search-results class=container></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=docs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/getting-started/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class=collapse id=docsgetting-started><a class="td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedgetting-started-chunks-storage href=/docs/getting-started/getting-started-chunks-storage/>Chunks Storage</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedgetting-started-blocks-storage href=/docs/getting-started/getting-started-blocks-storage/>Blocks Storage</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedgetting-started-with-gossiped-ring href=/docs/getting-started/getting-started-with-gossiped-ring/>Gossip Ring</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docsarchitecture href=/docs/architecture/>Architecture</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/production/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Production</a></li><ul><li class=collapse id=docsproduction><a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductionrunning-in-production href=/docs/production/running-in-production/>Running Cortex in Production</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductionaws href=/docs/production/aws/>Running Cortex with AWS Services</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductioncassandra href=/docs/production/cassandra/>Running Cortex with Cassandra</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductioncaching href=/docs/production/caching/>Caching in Cortex</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductioningesters-with-wal href=/docs/production/ingesters-with-wal/>Ingesters with WAL</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductiontls href=/docs/production/tls/>Securing communication between Cortex components with TLS</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductionauth href=/docs/production/auth/>Authentication and Authorisation</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproductionha-pair-handling href=/docs/production/ha-pair-handling/>Config for sending HA Pairs data to Cortex</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/api/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">HTTP API</a></li><ul><li class=collapse id=docsapi></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/guides/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Guides</a></li><ul><li class=collapse id=docsguides><a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidesdeleting-series href=/docs/guides/deleting-series/>Deleting Series</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidesgrpc-based-plugin href=/docs/guides/grpc-based-plugin/>gRPC storage plugin</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidesruler-sharding href=/docs/guides/ruler-sharding/>Config for horizontally scaling the Ruler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidesshuffle-sharding href=/docs/guides/shuffle-sharding/>Shuffle Sharding</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguideszone-aware-replication href=/docs/guides/zone-aware-replication/>Zone Aware Replication</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguideskubernetes href=/docs/guides/kubernetes/>Running Cortex on Kubernetes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidestracing href=/docs/guides/tracing/>Tracing</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidesingesters-rolling-updates href=/docs/guides/ingesters-rolling-updates/>Ingesters rolling updates</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsguidescapacity-planning href=/docs/guides/capacity-planning/>Capacity Planning</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/configuration/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configuration</a></li><ul><li class=collapse id=docsconfiguration><a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationconfiguration-file href=/docs/configuration/configuration-file/>Configuration file</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationarguments href=/docs/configuration/arguments/>Cortex Arguments Explained</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationprometheus-frontend href=/docs/configuration/prometheus-frontend/>Prometheus Frontend</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationschema-configuration href=/docs/configuration/schema-configuration/>Schema Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationsingle-process-config href=/docs/configuration/single-process-config/>Single-process</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationv1guarantees href=/docs/configuration/v1guarantees/>v1.x Guarantees</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/operations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Operations</a></li><ul><li class=collapse id=docsoperations><a class="td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-auditor href=/docs/operations/query-auditor/>Query Auditor (tool)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-tee href=/docs/operations/query-tee/>Query Tee (service)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoperationsrequests-mirroring-to-secondary-cluster href=/docs/operations/requests-mirroring-to-secondary-cluster/>Requests mirroring to secondary cluster</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoperationsscaling-query-frontend href=/docs/operations/scaling-query-frontend/>Scaling the Query Frontend</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/blocks-storage/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Blocks Storage</a></li><ul><li class=collapse id=docsblocks-storage><a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagequerier href=/docs/blocks-storage/querier/>Querier</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagestore-gateway href=/docs/blocks-storage/store-gateway/>Store-gateway</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagecompactor href=/docs/blocks-storage/compactor/>Compactor</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageproduction-tips href=/docs/blocks-storage/production-tips/>Production tips</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagebinary-index-header href=/docs/blocks-storage/binary-index-header/>Binary index-header</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-cortex-cluster-from-chunks-to-blocks href=/docs/blocks-storage/migrate-cortex-cluster-from-chunks-to-blocks/>Migrate Cortex cluster from chunks to blocks</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageconvert-long-term-storage-from-chunks-to-blocks href=/docs/blocks-storage/convert-long-term-storage-from-chunks-to-blocks/>Convert long-term storage from chunks to blocks</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-storage-from-thanos-and-prometheus href=/docs/blocks-storage/migrate-storage-from-thanos-and-prometheus/>Migrate the storage from Thanos and Prometheus</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/contributing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contributing</a></li><ul><li class=collapse id=docscontributing><a class="td-sidebar-link td-sidebar-link__page" id=m-docscontributingdesign-patterns-and-code-conventions href=/docs/contributing/design-patterns-and-code-conventions/>Design patterns and Code conventions</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-run-the-website-locally href=/docs/contributing/how-to-run-the-website-locally/>How to run the website locally</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-upgrade-golang-version href=/docs/contributing/how-to-upgrade-golang-version/>How to upgrade Golang version</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-integration-tests-work href=/docs/contributing/how-integration-tests-work/>How integration tests work</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-update-the-build-image href=/docs/contributing/how-to-update-the-build-image/>How to update the build image</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/case-studies/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Case Studies</a></li><ul><li class=collapse id=docscase-studies><a class="td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesgojek href=/docs/case-studies/gojek/>Gojek</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesrewe-digital href=/docs/case-studies/rewe-digital/>REWE digital</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/governance/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Governance</a></li><ul><li class=collapse id=docsgovernance><a class="td-sidebar-link td-sidebar-link__page" id=m-docsgovernancehow-to-add-a-maintainer href=/docs/governance/how-to-add-a-maintainer/>How to add a maintainer</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page active" id=m-docschangelog href=/docs/changelog/>Changelog</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/proposals/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Proposals</a></li><ul><li class=collapse id=docsproposals><a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblocks-storage-sharding href=/docs/proposals/blocks-storage-sharding/>Blocks storage sharding</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsdocumentation-versioning href=/docs/proposals/documentation-versioning/>Documentation Versioning</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsgeneralize-modules href=/docs/proposals/generalize-modules/>Generalize Modules Service to make it extensible</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalshttp-api-design href=/docs/proposals/http-api-design/>HTTP API Design</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsingesters-migration href=/docs/proposals/ingesters-migration/>Migrating ingesters from chunks to blocks and back.</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsscalable-query-frontend href=/docs/proposals/scalable-query-frontend/>Scalable Query Frontend</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-and-zone-awareness href=/docs/proposals/shuffle-sharding-and-zone-awareness/>Shuffle sharding and zone awareness</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-on-the-read-path href=/docs/proposals/shuffle-sharding-on-the-read-path/>Shuffle sharding on the read path</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsproposalssupport-metadata-api href=/docs/proposals/support-metadata-api/>Support metadata API</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docscode-of-conduct href=/docs/code-of-conduct/>Code of Conduct</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsroadmap href=/docs/roadmap/>Roadmap</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cortexproject/cortex/edit/master/CHANGELOG.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/cortexproject/cortex/issues/new?title=Changelog" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/cortexproject/cortex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#master--unreleased>master / unreleased</a></li><li><a href=#140--2020-10-02>1.4.0 / 2020-10-02</a></li><li><a href=#130--2020-08-21>1.3.0 / 2020-08-21</a></li><li><a href=#120--2020-07-01>1.2.0 / 2020-07-01</a></li><li><a href=#110--2020-05-21>1.1.0 / 2020-05-21</a></li><li><a href=#101--2020-04-23>1.0.1 / 2020-04-23</a></li><li><a href=#100--2020-04-02>1.0.0 / 2020-04-02</a><ul><li><a href=#known-issues>Known issues</a></li><li><a href=#config-file-breaking-changes>Config file breaking changes</a></li></ul></li><li><a href=#070--2020-03-16>0.7.0 / 2020-03-16</a><ul><li><a href=#full-changelog>Full changelog</a></li><li><a href=#changes-to-denormalised-tokens-in-the-ring>Changes to denormalised tokens in the ring</a></li><li><a href=#known-issues-1>Known issues</a></li><li><a href=#annotated-config-file-breaking-changes>Annotated config file breaking changes</a></li></ul></li><li><a href=#061--2020-02-05>0.6.1 / 2020-02-05</a></li><li><a href=#060--2020-01-28>0.6.0 / 2020-01-28</a><ul><li><a href=#upgrading-postgresql-if-youre-using-configs-service>Upgrading PostgreSQL (if you&rsquo;re using configs service)</a></li><li><a href=#known-issues-2>Known issues</a></li></ul></li><li><a href=#040--2019-12-02>0.4.0 / 2019-12-02</a></li><li><a href=#030--2019-10-11>0.3.0 / 2019-10-11</a></li><li><a href=#020--2019-09-05>0.2.0 / 2019-09-05</a></li><li><a href=#010--2019-08-07>0.1.0 / 2019-08-07</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/changelog/>Changelog</a></li></ol></nav><div class=td-content><h1>Changelog</h1><h2 id=master--unreleased>master / unreleased</h2><ul><li>[CHANGE] Blocks storage: update the default HTTP configuration values for the S3 client to the upstream Thanos default values. <a href=https://github.com/cortexproject/cortex/pull/3244>#3244</a><ul><li><code>-blocks-storage.s3.http.idle-conn-timeout</code> is set 90 seconds.</li><li><code>-blocks-storage.s3.http.response-header-timeout</code> is set to 2 minutes.</li></ul></li><li>[CHANGE] Improved shuffle sharding support in the write path. This work introduced some config changes: <a href=https://github.com/cortexproject/cortex/pull/3090>#3090</a><ul><li>Introduced <code>-distributor.sharding-strategy</code> CLI flag (and its respective <code>sharding_strategy</code> YAML config option) to explicitly specify which sharding strategy should be used in the write path</li><li><code>-experimental.distributor.user-subring-size</code> flag renamed to <code>-distributor.ingestion-tenant-shard-size</code></li><li><code>user_subring_size</code> limit YAML config option renamed to <code>ingestion_tenant_shard_size</code></li></ul></li><li>[CHANGE] Dropped &ldquo;blank Alertmanager configuration; using fallback&rdquo; message from Info to Debug level. <a href=https://github.com/cortexproject/cortex/pull/3205>#3205</a></li><li>[CHANGE] Zone-awareness replication for time-series now should be explicitly enabled in the distributor via the <code>-distributor.zone-awareness-enabled</code> CLI flag (or its respective YAML config option). Before, zone-aware replication was implicitly enabled if a zone was set on ingesters. <a href=https://github.com/cortexproject/cortex/pull/3200>#3200</a></li><li>[CHANGE] Removed the deprecated CLI flag <code>-config-yaml</code>. You should use <code>-schema-config-file</code> instead. <a href=https://github.com/cortexproject/cortex/pull/3225>#3225</a></li><li>[CHANGE] Enforced the HTTP method required by some API endpoints which did (incorrectly) allow any method before that. <a href=https://github.com/cortexproject/cortex/pull/3228>#3228</a><ul><li><code>GET /</code></li><li><code>GET /config</code></li><li><code>GET /debug/fgprof</code></li><li><code>GET /distributor/all_user_stats</code></li><li><code>GET /distributor/ha_tracker</code></li><li><code>GET /all_user_stats</code></li><li><code>GET /ha-tracker</code></li><li><code>GET /api/v1/user_stats</code></li><li><code>GET /api/v1/chunks</code></li><li><code>GET &lt;legacy-http-prefix>/user_stats</code></li><li><code>GET &lt;legacy-http-prefix>/chunks</code></li><li><code>GET /services</code></li><li><code>GET /multitenant_alertmanager/status</code></li><li><code>GET /status</code> (alertmanager microservice)</li><li><code>GET|POST /ingester/ring</code></li><li><code>GET|POST /ring</code></li><li><code>GET|POST /store-gateway/ring</code></li><li><code>GET|POST /compactor/ring</code></li><li><code>GET|POST /ingester/flush</code></li><li><code>GET|POST /ingester/shutdown</code></li><li><code>GET|POST /flush</code></li><li><code>GET|POST /shutdown</code></li><li><code>GET|POST /ruler/ring</code></li><li><code>POST /api/v1/push</code></li><li><code>POST &lt;legacy-http-prefix>/push</code></li><li><code>POST /push</code></li><li><code>POST /ingester/push</code></li></ul></li><li>[CHANGE] Renamed CLI flags to configure the network interface names from which automatically detect the instance IP. <a href=https://github.com/cortexproject/cortex/pull/3295>#3295</a><ul><li><code>-compactor.ring.instance-interface</code> renamed to <code>-compactor.ring.instance-interface-names</code></li><li><code>-store-gateway.sharding-ring.instance-interface</code> renamed to <code>-store-gateway.sharding-ring.instance-interface-names</code></li><li><code>-distributor.ring.instance-interface</code> renamed to <code>-distributor.ring.instance-interface-names</code></li><li><code>-ruler.ring.instance-interface</code> renamed to <code>-ruler.ring.instance-interface-names</code></li></ul></li><li>[CHANGE] Renamed <code>-&lt;prefix>.redis.enable-tls</code> CLI flag to <code>-&lt;prefix>.redis.tls-enabled</code>, and its respective YAML config option from <code>enable_tls</code> to <code>tls_enabled</code>. <a href=https://github.com/cortexproject/cortex/pull/3298>#3298</a></li><li>[CHANGE] Increased default <code>-&lt;prefix>.redis.timeout</code> from <code>100ms</code> to <code>500ms</code>. <a href=https://github.com/cortexproject/cortex/pull/3301>#3301</a></li><li>[FEATURE] Added support for shuffle-sharding queriers in the query-frontend. When configured (<code>-frontend.max-queriers-per-tenant</code> globally, or using per-tenant limit <code>max_queriers_per_tenant</code>), each tenants&rsquo;s requests will be handled by different set of queriers. <a href=https://github.com/cortexproject/cortex/pull/3113>#3113</a> <a href=https://github.com/cortexproject/cortex/pull/3257>#3257</a></li><li>[FEATURE] Query-frontend: added <code>compression</code> config to support results cache with compression. <a href=https://github.com/cortexproject/cortex/pull/3217>#3217</a></li><li>[ENHANCEMENT] Allow to specify multiple comma-separated Cortex services to <code>-target</code> CLI option (or its respective YAML config option). For example, <code>-target=all,compactor</code> can be used to start Cortex single-binary with compactor as well. <a href=https://github.com/cortexproject/cortex/pull/3275>#3275</a></li><li>[ENHANCEMENT] Expose additional HTTP configs for the S3 backend client. New flag are listed below: <a href=https://github.com/cortexproject/cortex/pull/3244>#3244</a><ul><li><code>-blocks-storage.s3.http.idle-conn-timeout</code></li><li><code>-blocks-storage.s3.http.response-header-timeout</code></li><li><code>-blocks-storage.s3.http.insecure-skip-verify</code></li></ul></li><li>[ENHANCEMENT] Added <code>cortex_query_frontend_connected_clients</code> metric to show the number of workers currently connected to the frontend. <a href=https://github.com/cortexproject/cortex/pull/3207>#3207</a></li><li>[ENHANCEMENT] Shuffle sharding: improved shuffle sharding in the write path. Shuffle sharding now should be explicitly enabled via <code>-distributor.sharding-strategy</code> CLI flag (or its respective YAML config option) and guarantees stability, consistency, shuffling and balanced zone-awareness properties. <a href=https://github.com/cortexproject/cortex/pull/3090>#3090</a> <a href=https://github.com/cortexproject/cortex/pull/3214>#3214</a></li><li>[ENHANCEMENT] Ingester: added new metric <code>cortex_ingester_active_series</code> to track active series more accurately. Also added options to control whether active series tracking is enabled (<code>-ingester.active-series-enabled</code>, defaults to false), and how often this metric is updated (<code>-ingester.active-series-update-period</code>) and max idle time for series to be considered inactive (<code>-ingester.active-series-idle-timeout</code>). <a href=https://github.com/cortexproject/cortex/pull/3153>#3153</a></li><li>[ENHANCEMENT] Blocksconvert – Builder: download plan file locally before processing it. <a href=https://github.com/cortexproject/cortex/pull/3209>#3209</a></li><li>[ENHANCEMENT] Blocksconvert – Cleaner: added new tool for deleting chunks data. <a href=https://github.com/cortexproject/cortex/pull/3283>#3283</a></li><li>[ENHANCEMENT] Store-gateway: added zone-aware replication support to blocks replication in the store-gateway. <a href=https://github.com/cortexproject/cortex/pull/3200>#3200</a></li><li>[ENHANCEMENT] Store-gateway: exported new metrics. <a href=https://github.com/cortexproject/cortex/pull/3231>#3231</a><ul><li><code>cortex_bucket_store_cached_series_fetch_duration_seconds</code></li><li><code>cortex_bucket_store_cached_postings_fetch_duration_seconds</code></li><li><code>cortex_bucket_stores_gate_queries_max</code></li></ul></li><li>[ENHANCEMENT] Added <code>-version</code> flag to Cortex. <a href=https://github.com/cortexproject/cortex/pull/3233>#3233</a></li><li>[ENHANCEMENT] Blocksconvert – Scanner: support for scanning specific date-range only. <a href=https://github.com/cortexproject/cortex/pull/3222>#3222</a></li><li>[ENHANCEMENT] Blocksconvert – Scanner: metrics for tracking progress. <a href=https://github.com/cortexproject/cortex/pull/3222>#3222</a></li><li>[ENHANCEMENT] Blocksconvert – Builder: retry block upload before giving up. <a href=https://github.com/cortexproject/cortex/pull/3245>#3245</a></li><li>[ENHANCEMENT] Hash ring: added instance registered timestamp to the ring. <a href=https://github.com/cortexproject/cortex/pull/3248>#3248</a></li><li>[ENHANCEMENT] Reduce tail latency by smoothing out spikes in rate of chunk flush operations. <a href=https://github.com/cortexproject/cortex/pull/3191>#3191</a></li><li>[ENHANCEMENT] User Cortex as User Agent in http requests issued by Configs DB client. <a href=https://github.com/cortexproject/cortex/pull/3264>#3264</a></li><li>[ENHANCEMENT] Experimental Ruler API: Fetch rule groups from object storage in parallel. <a href=https://github.com/cortexproject/cortex/pull/3218>#3218</a></li><li>[ENHANCEMENT] Chunks GCS object storage client uses the <code>fields</code> selector to limit the payload size when listing objects in the bucket. <a href=https://github.com/cortexproject/cortex/pull/3218>#3218</a> <a href=https://github.com/cortexproject/cortex/pull/3292>#3292</a></li><li>[ENHANCEMENT] Added shuffle sharding support to ruler. Added new metric <code>cortex_ruler_sync_rules_total</code>. <a href=https://github.com/cortexproject/cortex/pull/3235>#3235</a></li><li>[ENHANCEMENT] Return an explicit error when the store-gateway is explicitly requested without a blocks storage engine. <a href=https://github.com/cortexproject/cortex/pull/3287>#3287</a></li><li>[ENHANCEMENT] Ruler: only load rules that belong to the ruler. Improves rules synching performances when ruler sharding is enabled. <a href=https://github.com/cortexproject/cortex/pull/3269>#3269</a></li><li>[ENHANCEMENT] Added <code>-&lt;prefix>.redis.tls-insecure-skip-verify</code> flag. <a href=https://github.com/cortexproject/cortex/pull/3298>#3298</a></li><li>[BUGFIX] No-longer-needed ingester operations for queries triggered by queriers and rulers are now canceled. <a href=https://github.com/cortexproject/cortex/pull/3178>#3178</a></li><li>[BUGFIX] Ruler: directories in the configured <code>rules-path</code> will be removed on startup and shutdown in order to ensure they don&rsquo;t persist between runs. <a href=https://github.com/cortexproject/cortex/pull/3195>#3195</a></li><li>[BUGFIX] Handle hash-collisions in the query path. <a href=https://github.com/cortexproject/cortex/pull/3192>#3192</a></li><li>[BUGFIX] Check for postgres rows errors. <a href=https://github.com/cortexproject/cortex/pull/3197>#3197</a></li><li>[BUGFIX] Ruler Experimental API: Don&rsquo;t allow rule groups without names or empty rule groups. <a href=https://github.com/cortexproject/cortex/pull/3210>#3210</a></li><li>[BUGFIX] Experimental Alertmanager API: Do not allow empty Alertmanager configurations or bad template filenames to be submitted through the configuration API. <a href=https://github.com/cortexproject/cortex/pull/3185>#3185</a></li><li>[BUGFIX] Reduce failures to update heartbeat when using Consul. <a href=https://github.com/cortexproject/cortex/pull/3259>#3259</a></li><li>[BUGFIX] When using ruler sharding, moving all user rule groups from ruler to a different one and then back could end up with some user groups not being evaluated at all. <a href=https://github.com/cortexproject/cortex/pull/3235>#3235</a></li><li>[BUGFIX] Fixed shuffle sharding consistency when zone-awareness is enabled and the shard size is increased or instances in a new zone are added. <a href=https://github.com/cortexproject/cortex/pull/3299>#3299</a></li><li>[BUGFIX] Use a valid grpc header when logging IP addresses. <a href=https://github.com/cortexproject/cortex/pull/3307>#3307</a></li><li>[BUGFIX] Fixed the metric <code>cortex_prometheus_rule_group_duration_seconds</code> in the Ruler, it wouldn&rsquo;t report any values. <a href=https://github.com/cortexproject/cortex/pull/3310>#3310</a></li><li>[BUGFIX] Fixed gRPC connections leaking in rulers when rulers sharding is enabled and APIs called. <a href=https://github.com/cortexproject/cortex/pull/3314>#3314</a></li></ul><h2 id=140--2020-10-02>1.4.0 / 2020-10-02</h2><ul><li>[CHANGE] TLS configuration for gRPC, HTTP and etcd clients is now marked as experimental. These features are not yet fully baked, and we expect possible small breaking changes in Cortex 1.5. <a href=https://github.com/cortexproject/cortex/pull/3198>#3198</a></li><li>[CHANGE] Cassandra backend support is now GA (stable). <a href=https://github.com/cortexproject/cortex/pull/3180>#3180</a></li><li>[CHANGE] Blocks storage is now GA (stable). The <code>-experimental</code> prefix has been removed from all CLI flags related to the blocks storage (no YAML config changes). <a href=https://github.com/cortexproject/cortex/pull/3180>#3180</a> <a href=https://github.com/cortexproject/cortex/pull/3201>#3201</a><ul><li><code>-experimental.blocks-storage.*</code> flags renamed to <code>-blocks-storage.*</code></li><li><code>-experimental.store-gateway.*</code> flags renamed to <code>-store-gateway.*</code></li><li><code>-experimental.querier.store-gateway-client.*</code> flags renamed to <code>-querier.store-gateway-client.*</code></li><li><code>-experimental.querier.store-gateway-addresses</code> flag renamed to <code>-querier.store-gateway-addresses</code></li><li><code>-store-gateway.replication-factor</code> flag renamed to <code>-store-gateway.sharding-ring.replication-factor</code></li><li><code>-store-gateway.tokens-file-path</code> flag renamed to <code>store-gateway.sharding-ring.tokens-file-path</code></li></ul></li><li>[CHANGE] Ingester: Removed deprecated untyped record from chunks WAL. Only if you are running <code>v1.0</code> or below, it is recommended to first upgrade to <code>v1.1</code>/<code>v1.2</code>/<code>v1.3</code> and run it for a day before upgrading to <code>v1.4</code> to avoid data loss. <a href=https://github.com/cortexproject/cortex/pull/3115>#3115</a></li><li>[CHANGE] Distributor API endpoints are no longer served unless target is set to <code>distributor</code> or <code>all</code>. <a href=https://github.com/cortexproject/cortex/pull/3112>#3112</a></li><li>[CHANGE] Increase the default Cassandra client replication factor to 3. <a href=https://github.com/cortexproject/cortex/pull/3007>#3007</a></li><li>[CHANGE] Blocks storage: removed the support to transfer blocks between ingesters on shutdown. When running the Cortex blocks storage, ingesters are expected to run with a persistent disk. The following metrics have been removed: <a href=https://github.com/cortexproject/cortex/pull/2996>#2996</a><ul><li><code>cortex_ingester_sent_files</code></li><li><code>cortex_ingester_received_files</code></li><li><code>cortex_ingester_received_bytes_total</code></li><li><code>cortex_ingester_sent_bytes_total</code></li></ul></li><li>[CHANGE] The buckets for the <code>cortex_chunk_store_index_lookups_per_query</code> metric have been changed to 1, 2, 4, 8, 16. <a href=https://github.com/cortexproject/cortex/pull/3021>#3021</a></li><li>[CHANGE] Blocks storage: the <code>operation</code> label value <code>getrange</code> has changed into <code>get_range</code> for the metrics <code>thanos_store_bucket_cache_operation_requests_total</code> and <code>thanos_store_bucket_cache_operation_hits_total</code>. <a href=https://github.com/cortexproject/cortex/pull/3000>#3000</a></li><li>[CHANGE] Experimental Delete Series: <code>/api/v1/admin/tsdb/delete_series</code> and <code>/api/v1/admin/tsdb/cancel_delete_request</code> purger APIs to return status code <code>204</code> instead of <code>200</code> for success. <a href=https://github.com/cortexproject/cortex/pull/2946>#2946</a></li><li>[CHANGE] Histogram <code>cortex_memcache_request_duration_seconds</code> <code>method</code> label value changes from <code>Memcached.Get</code> to <code>Memcached.GetBatched</code> for batched lookups, and is not reported for non-batched lookups (label value <code>Memcached.GetMulti</code> remains, and had exactly the same value as <code>Get</code> in nonbatched lookups). The same change applies to tracing spans. <a href=https://github.com/cortexproject/cortex/pull/3046>#3046</a></li><li>[CHANGE] TLS server validation is now enabled by default, a new parameter <code>tls_insecure_skip_verify</code> can be set to true to skip validation optionally. <a href=https://github.com/cortexproject/cortex/pull/3030>#3030</a></li><li>[CHANGE] <code>cortex_ruler_config_update_failures_total</code> has been removed in favor of <code>cortex_ruler_config_last_reload_successful</code>. <a href=https://github.com/cortexproject/cortex/pull/3056>#3056</a></li><li>[CHANGE] <code>ruler.evaluation_delay_duration</code> field in YAML config has been moved and renamed to <code>limits.ruler_evaluation_delay_duration</code>. <a href=https://github.com/cortexproject/cortex/pull/3098>#3098</a></li><li>[CHANGE] Removed obsolete <code>results_cache.max_freshness</code> from YAML config (deprecated since Cortex 1.2). <a href=https://github.com/cortexproject/cortex/pull/3145>#3145</a></li><li>[CHANGE] Removed obsolete <code>-promql.lookback-delta</code> option (deprecated since Cortex 1.2, replaced with <code>-querier.lookback-delta</code>). <a href=https://github.com/cortexproject/cortex/pull/3144>#3144</a></li><li>[CHANGE] Cache: added support for Redis Cluster and Redis Sentinel. <a href=https://github.com/cortexproject/cortex/pull/2961>#2961</a><ul><li>The following changes have been made in Redis configuration:</li><li><code>-redis.master_name</code> added</li><li><code>-redis.db</code> added</li><li><code>-redis.max-active-conns</code> changed to <code>-redis.pool-size</code></li><li><code>-redis.max-conn-lifetime</code> changed to <code>-redis.max-connection-age</code></li><li><code>-redis.max-idle-conns</code> removed</li><li><code>-redis.wait-on-pool-exhaustion</code> removed</li></ul></li><li>[CHANGE] TLS configuration for gRPC, HTTP and etcd clients is now marked as experimental. These features are not yet fully baked, and we expect possible small breaking changes in Cortex 1.5. <a href=https://github.com/cortexproject/cortex/pull/3198>#3198</a></li><li>[CHANGE] Fixed store-gateway CLI flags inconsistencies. <a href=https://github.com/cortexproject/cortex/pull/3201>#3201</a><ul><li><code>-store-gateway.replication-factor</code> flag renamed to <code>-store-gateway.sharding-ring.replication-factor</code></li><li><code>-store-gateway.tokens-file-path</code> flag renamed to <code>store-gateway.sharding-ring.tokens-file-path</code></li></ul></li><li>[FEATURE] Logging of the source IP passed along by a reverse proxy is now supported by setting the <code>-server.log-source-ips-enabled</code>. For non standard headers the settings <code>-server.log-source-ips-header</code> and <code>-server.log-source-ips-regex</code> can be used. <a href=https://github.com/cortexproject/cortex/pull/2985>#2985</a></li><li>[FEATURE] Blocks storage: added shuffle sharding support to store-gateway blocks sharding. Added the following additional metrics to store-gateway: <a href=https://github.com/cortexproject/cortex/pull/3069>#3069</a><ul><li><code>cortex_bucket_stores_tenants_discovered</code></li><li><code>cortex_bucket_stores_tenants_synced</code></li></ul></li><li>[FEATURE] Experimental blocksconvert: introduce an experimental tool <code>blocksconvert</code> to migrate long-term storage chunks to blocks. <a href=https://github.com/cortexproject/cortex/pull/3092>#3092</a> <a href=https://github.com/cortexproject/cortex/pull/3122>#3122</a> <a href=https://github.com/cortexproject/cortex/pull/3127>#3127</a> <a href=https://github.com/cortexproject/cortex/pull/3162>#3162</a></li><li>[ENHANCEMENT] Add support for azure storage in China, German and US Government environments. <a href=https://github.com/cortexproject/cortex/pull/2988>#2988</a></li><li>[ENHANCEMENT] Query-tee: added a small tolerance to floating point sample values comparison. <a href=https://github.com/cortexproject/cortex/pull/2994>#2994</a></li><li>[ENHANCEMENT] Query-tee: add support for doing a passthrough of requests to preferred backend for unregistered routes <a href=https://github.com/cortexproject/cortex/pull/3018>#3018</a></li><li>[ENHANCEMENT] Expose <code>storage.aws.dynamodb.backoff_config</code> configuration file field. <a href=https://github.com/cortexproject/cortex/pull/3026>#3026</a></li><li>[ENHANCEMENT] Added <code>cortex_request_message_bytes</code> and <code>cortex_response_message_bytes</code> histograms to track received and sent gRPC message and HTTP request/response sizes. Added <code>cortex_inflight_requests</code> gauge to track number of inflight gRPC and HTTP requests. <a href=https://github.com/cortexproject/cortex/pull/3064>#3064</a></li><li>[ENHANCEMENT] Publish ruler&rsquo;s ring metrics. <a href=https://github.com/cortexproject/cortex/pull/3074>#3074</a></li><li>[ENHANCEMENT] Add config validation to the experimental Alertmanager API. Invalid configs are no longer accepted. <a href=https://github.com/cortexproject/cortex/pull/3053>#3053</a></li><li>[ENHANCEMENT] Add &ldquo;integration&rdquo; as a label for <code>cortex_alertmanager_notifications_total</code> and <code>cortex_alertmanager_notifications_failed_total</code> metrics. <a href=https://github.com/cortexproject/cortex/pull/3056>#3056</a></li><li>[ENHANCEMENT] Add <code>cortex_ruler_config_last_reload_successful</code> and <code>cortex_ruler_config_last_reload_successful_seconds</code> to check status of users rule manager. <a href=https://github.com/cortexproject/cortex/pull/3056>#3056</a></li><li>[ENHANCEMENT] The configuration validation now fails if an empty YAML node has been set for a root YAML config property. <a href=https://github.com/cortexproject/cortex/pull/3080>#3080</a></li><li>[ENHANCEMENT] Memcached dial() calls now have a circuit-breaker to avoid hammering a broken cache. <a href=https://github.com/cortexproject/cortex/pull/3051>#3051</a>, <a href=https://github.com/cortexproject/cortex/pull/3189>#3189</a></li><li>[ENHANCEMENT] <code>-ruler.evaluation-delay-duration</code> is now overridable as a per-tenant limit, <code>ruler_evaluation_delay_duration</code>. <a href=https://github.com/cortexproject/cortex/pull/3098>#3098</a></li><li>[ENHANCEMENT] Add TLS support to etcd client. <a href=https://github.com/cortexproject/cortex/pull/3102>#3102</a></li><li>[ENHANCEMENT] When a tenant accesses the Alertmanager UI or its API, if we have valid <code>-alertmanager.configs.fallback</code> we&rsquo;ll use that to start the manager and avoid failing the request. <a href=https://github.com/cortexproject/cortex/pull/3073>#3073</a></li><li>[ENHANCEMENT] Add <code>DELETE api/v1/rules/{namespace}</code> to the Ruler. It allows all the rule groups of a namespace to be deleted. <a href=https://github.com/cortexproject/cortex/pull/3120>#3120</a></li><li>[ENHANCEMENT] Experimental Delete Series: Retry processing of Delete requests during failures. <a href=https://github.com/cortexproject/cortex/pull/2926>#2926</a></li><li>[ENHANCEMENT] Improve performance of QueryStream() in ingesters. <a href=https://github.com/cortexproject/cortex/pull/3177>#3177</a></li><li>[ENHANCEMENT] Modules included in &ldquo;All&rdquo; target are now visible in output of <code>-modules</code> CLI flag. <a href=https://github.com/cortexproject/cortex/pull/3155>#3155</a></li><li>[ENHANCEMENT] Added <code>/debug/fgprof</code> endpoint to debug running Cortex process using <code>fgprof</code>. This adds up to the existing <code>/debug/...</code> endpoints. <a href=https://github.com/cortexproject/cortex/pull/3131>#3131</a></li><li>[ENHANCEMENT] Blocks storage: optimised <code>/api/v1/series</code> for blocks storage. (<a href=https://github.com/cortexproject/cortex/pull/2976>#2976</a>)</li><li>[BUGFIX] Ruler: when loading rules from &ldquo;local&rdquo; storage, check for directory after resolving symlink. <a href=https://github.com/cortexproject/cortex/pull/3137>#3137</a></li><li>[BUGFIX] Query-frontend: Fixed rounding for incoming query timestamps, to be 100% Prometheus compatible. <a href=https://github.com/cortexproject/cortex/pull/2990>#2990</a></li><li>[BUGFIX] Querier: Merge results from chunks and blocks ingesters when using streaming of results. <a href=https://github.com/cortexproject/cortex/pull/3013>#3013</a></li><li>[BUGFIX] Querier: query /series from ingesters regardless the <code>-querier.query-ingesters-within</code> setting. <a href=https://github.com/cortexproject/cortex/pull/3035>#3035</a></li><li>[BUGFIX] Blocks storage: Ingester is less likely to hit gRPC message size limit when streaming data to queriers. <a href=https://github.com/cortexproject/cortex/pull/3015>#3015</a></li><li>[BUGFIX] Blocks storage: fixed memberlist support for the store-gateways and compactors ring used when blocks sharding is enabled. <a href=https://github.com/cortexproject/cortex/pull/3058>#3058</a> <a href=https://github.com/cortexproject/cortex/pull/3095>#3095</a></li><li>[BUGFIX] Fix configuration for TLS server validation, TLS skip verify was hardcoded to true for all TLS configurations and prevented validation of server certificates. <a href=https://github.com/cortexproject/cortex/pull/3030>#3030</a></li><li>[BUGFIX] Fixes the Alertmanager panicking when no <code>-alertmanager.web.external-url</code> is provided. <a href=https://github.com/cortexproject/cortex/pull/3017>#3017</a></li><li>[BUGFIX] Fixes the registration of the Alertmanager API metrics <code>cortex_alertmanager_alerts_received_total</code> and <code>cortex_alertmanager_alerts_invalid_total</code>. <a href=https://github.com/cortexproject/cortex/pull/3065>#3065</a></li><li>[BUGFIX] Fixes <code>flag needs an argument: -config.expand-env</code> error. <a href=https://github.com/cortexproject/cortex/pull/3087>#3087</a></li><li>[BUGFIX] An index optimisation actually slows things down when using caching. Moved it to the right location. <a href=https://github.com/cortexproject/cortex/pull/2973>#2973</a></li><li>[BUGFIX] Ingester: If push request contained both valid and invalid samples, valid samples were ingested but not stored to WAL of the chunks storage. This has been fixed. <a href=https://github.com/cortexproject/cortex/pull/3067>#3067</a></li><li>[BUGFIX] Cassandra: fixed consistency setting in the CQL session when creating the keyspace. <a href=https://github.com/cortexproject/cortex/pull/3105>#3105</a></li><li>[BUGFIX] Ruler: Config API would return both the <code>record</code> and <code>alert</code> in <code>YAML</code> response keys even when one of them must be empty. <a href=https://github.com/cortexproject/cortex/pull/3120>#3120</a></li><li>[BUGFIX] Index page now uses configured HTTP path prefix when creating links. <a href=https://github.com/cortexproject/cortex/pull/3126>#3126</a></li><li>[BUGFIX] Purger: fixed deadlock when reloading of tombstones failed. <a href=https://github.com/cortexproject/cortex/pull/3182>#3182</a></li><li>[BUGFIX] Fixed panic in flusher job, when error writing chunks to the store would cause &ldquo;idle&rdquo; chunks to be flushed, which triggered panic. <a href=https://github.com/cortexproject/cortex/pull/3140>#3140</a></li><li>[BUGFIX] Index page no longer shows links that are not valid for running Cortex instance. <a href=https://github.com/cortexproject/cortex/pull/3133>#3133</a></li><li>[BUGFIX] Configs: prevent validation of templates to fail when using template functions. <a href=https://github.com/cortexproject/cortex/pull/3157>#3157</a></li><li>[BUGFIX] Configuring the S3 URL with an <code>@</code> but without username and password doesn&rsquo;t enable the AWS static credentials anymore. <a href=https://github.com/cortexproject/cortex/pull/3170>#3170</a></li><li>[BUGFIX] Limit errors on ranged queries (<code>api/v1/query_range</code>) no longer return a status code <code>500</code> but <code>422</code> instead. <a href=https://github.com/cortexproject/cortex/pull/3167>#3167</a></li><li>[BUGFIX] Handle hash-collisions in the query path. Before this fix, Cortex could occasionally mix up two different series in a query, leading to invalid results, when <code>-querier.ingester-streaming</code> was used. <a href=https://github.com/cortexproject/cortex/pull/3192>#3192</a></li></ul><h2 id=130--2020-08-21>1.3.0 / 2020-08-21</h2><ul><li>[CHANGE] Replace the metric <code>cortex_alertmanager_configs</code> with <code>cortex_alertmanager_config_invalid</code> exposed by Alertmanager. <a href=https://github.com/cortexproject/cortex/pull/2960>#2960</a></li><li>[CHANGE] Experimental Delete Series: Change target flag for purger from <code>data-purger</code> to <code>purger</code>. <a href=https://github.com/cortexproject/cortex/pull/2777>#2777</a></li><li>[CHANGE] Experimental blocks storage: The max concurrent queries against the long-term storage, configured via <code>-experimental.blocks-storage.bucket-store.max-concurrent</code>, is now a limit shared across all tenants and not a per-tenant limit anymore. The default value has changed from <code>20</code> to <code>100</code> and the following new metrics have been added: <a href=https://github.com/cortexproject/cortex/pull/2797>#2797</a><ul><li><code>cortex_bucket_stores_gate_queries_concurrent_max</code></li><li><code>cortex_bucket_stores_gate_queries_in_flight</code></li><li><code>cortex_bucket_stores_gate_duration_seconds</code></li></ul></li><li>[CHANGE] Metric <code>cortex_ingester_flush_reasons</code> has been renamed to <code>cortex_ingester_flushing_enqueued_series_total</code>, and new metric <code>cortex_ingester_flushing_dequeued_series_total</code> with <code>outcome</code> label (superset of reason) has been added. <a href=https://github.com/cortexproject/cortex/pull/2802>#2802</a> <a href=https://github.com/cortexproject/cortex/pull/2818>#2818</a> <a href=https://github.com/cortexproject/cortex/pull/2998>#2998</a></li><li>[CHANGE] Experimental Delete Series: Metric <code>cortex_purger_oldest_pending_delete_request_age_seconds</code> would track age of delete requests since they are over their cancellation period instead of their creation time. <a href=https://github.com/cortexproject/cortex/pull/2806>#2806</a></li><li>[CHANGE] Experimental blocks storage: the store-gateway service is required in a Cortex cluster running with the experimental blocks storage. Removed the <code>-experimental.tsdb.store-gateway-enabled</code> CLI flag and <code>store_gateway_enabled</code> YAML config option. The store-gateway is now always enabled when the storage engine is <code>blocks</code>. <a href=https://github.com/cortexproject/cortex/pull/2822>#2822</a></li><li>[CHANGE] Experimental blocks storage: removed support for <code>-experimental.blocks-storage.bucket-store.max-sample-count</code> flag because the implementation was flawed. To limit the number of samples/chunks processed by a single query you can set <code>-store.query-chunk-limit</code>, which is now supported by the blocks storage too. <a href=https://github.com/cortexproject/cortex/pull/2852>#2852</a></li><li>[CHANGE] Ingester: Chunks flushed via /flush stay in memory until retention period is reached. This affects <code>cortex_ingester_memory_chunks</code> metric. <a href=https://github.com/cortexproject/cortex/pull/2778>#2778</a></li><li>[CHANGE] Querier: the error message returned when the query time range exceeds <code>-store.max-query-length</code> has changed from <code>invalid query, length > limit (X > Y)</code> to <code>the query time range exceeds the limit (query length: X, limit: Y)</code>. <a href=https://github.com/cortexproject/cortex/pull/2826>#2826</a></li><li>[CHANGE] Add <code>component</code> label to metrics exposed by chunk, delete and index store clients. <a href=https://github.com/cortexproject/cortex/pull/2774>#2774</a></li><li>[CHANGE] Querier: when <code>-querier.query-ingesters-within</code> is configured, the time range of the query sent to ingesters is now manipulated to ensure the query start time is not older than &lsquo;now - query-ingesters-within&rsquo;. <a href=https://github.com/cortexproject/cortex/pull/2904>#2904</a></li><li>[CHANGE] KV: The <code>role</code> label which was a label of <code>multi</code> KV store client only has been added to metrics of every KV store client. If KV store client is not <code>multi</code>, then the value of <code>role</code> label is <code>primary</code>. <a href=https://github.com/cortexproject/cortex/pull/2837>#2837</a></li><li>[CHANGE] Added the <code>engine</code> label to the metrics exposed by the Prometheus query engine, to distinguish between <code>ruler</code> and <code>querier</code> metrics. <a href=https://github.com/cortexproject/cortex/pull/2854>#2854</a></li><li>[CHANGE] Added ruler to the single binary when started with <code>-target=all</code> (default). <a href=https://github.com/cortexproject/cortex/pull/2854>#2854</a></li><li>[CHANGE] Experimental blocks storage: compact head when opening TSDB. This should only affect ingester startup after it was unable to compact head in previous run. <a href=https://github.com/cortexproject/cortex/pull/2870>#2870</a></li><li>[CHANGE] Metric <code>cortex_overrides_last_reload_successful</code> has been renamed to <code>cortex_runtime_config_last_reload_successful</code>. <a href=https://github.com/cortexproject/cortex/pull/2874>#2874</a></li><li>[CHANGE] HipChat support has been removed from the alertmanager (because removed from the Prometheus upstream too). <a href=https://github.com/cortexproject/cortex/pull/2902>#2902</a></li><li>[CHANGE] Add constant label <code>name</code> to metric <code>cortex_cache_request_duration_seconds</code>. <a href=https://github.com/cortexproject/cortex/pull/2903>#2903</a></li><li>[CHANGE] Add <code>user</code> label to metric <code>cortex_query_frontend_queue_length</code>. <a href=https://github.com/cortexproject/cortex/pull/2939>#2939</a></li><li>[CHANGE] Experimental blocks storage: cleaned up the config and renamed &ldquo;TSDB&rdquo; to &ldquo;blocks storage&rdquo;. <a href=https://github.com/cortexproject/cortex/pull/2937>#2937</a><ul><li>The storage engine setting value has been changed from <code>tsdb</code> to <code>blocks</code>; this affects <code>-store.engine</code> CLI flag and its respective YAML option.</li><li>The root level YAML config has changed from <code>tsdb</code> to <code>blocks_storage</code></li><li>The prefix of all CLI flags has changed from <code>-experimental.tsdb.</code> to <code>-experimental.blocks-storage.</code></li><li>The following settings have been grouped under <code>tsdb</code> property in the YAML config and their CLI flags changed:<ul><li><code>-experimental.tsdb.dir</code> changed to <code>-experimental.blocks-storage.tsdb.dir</code></li><li><code>-experimental.tsdb.block-ranges-period</code> changed to <code>-experimental.blocks-storage.tsdb.block-ranges-period</code></li><li><code>-experimental.tsdb.retention-period</code> changed to <code>-experimental.blocks-storage.tsdb.retention-period</code></li><li><code>-experimental.tsdb.ship-interval</code> changed to <code>-experimental.blocks-storage.tsdb.ship-interval</code></li><li><code>-experimental.tsdb.ship-concurrency</code> changed to <code>-experimental.blocks-storage.tsdb.ship-concurrency</code></li><li><code>-experimental.tsdb.max-tsdb-opening-concurrency-on-startup</code> changed to <code>-experimental.blocks-storage.tsdb.max-tsdb-opening-concurrency-on-startup</code></li><li><code>-experimental.tsdb.head-compaction-interval</code> changed to <code>-experimental.blocks-storage.tsdb.head-compaction-interval</code></li><li><code>-experimental.tsdb.head-compaction-concurrency</code> changed to <code>-experimental.blocks-storage.tsdb.head-compaction-concurrency</code></li><li><code>-experimental.tsdb.head-compaction-idle-timeout</code> changed to <code>-experimental.blocks-storage.tsdb.head-compaction-idle-timeout</code></li><li><code>-experimental.tsdb.stripe-size</code> changed to <code>-experimental.blocks-storage.tsdb.stripe-size</code></li><li><code>-experimental.tsdb.wal-compression-enabled</code> changed to <code>-experimental.blocks-storage.tsdb.wal-compression-enabled</code></li><li><code>-experimental.tsdb.flush-blocks-on-shutdown</code> changed to <code>-experimental.blocks-storage.tsdb.flush-blocks-on-shutdown</code></li></ul></li></ul></li><li>[CHANGE] Flags <code>-bigtable.grpc-use-gzip-compression</code>, <code>-ingester.client.grpc-use-gzip-compression</code>, <code>-querier.frontend-client.grpc-use-gzip-compression</code> are now deprecated. <a href=https://github.com/cortexproject/cortex/pull/2940>#2940</a></li><li>[CHANGE] Limit errors reported by ingester during query-time now return HTTP status code 422. <a href=https://github.com/cortexproject/cortex/pull/2941>#2941</a></li><li>[FEATURE] Introduced <code>ruler.for-outage-tolerance</code>, Max time to tolerate outage for restoring &ldquo;for&rdquo; state of alert. <a href=https://github.com/cortexproject/cortex/pull/2783>#2783</a></li><li>[FEATURE] Introduced <code>ruler.for-grace-period</code>, Minimum duration between alert and restored &ldquo;for&rdquo; state. This is maintained only for alerts with configured &ldquo;for&rdquo; time greater than grace period. <a href=https://github.com/cortexproject/cortex/pull/2783>#2783</a></li><li>[FEATURE] Introduced <code>ruler.resend-delay</code>, Minimum amount of time to wait before resending an alert to Alertmanager. <a href=https://github.com/cortexproject/cortex/pull/2783>#2783</a></li><li>[FEATURE] Ruler: added <code>local</code> filesystem support to store rules (read-only). <a href=https://github.com/cortexproject/cortex/pull/2854>#2854</a></li><li>[ENHANCEMENT] Upgraded Docker base images to <code>alpine:3.12</code>. <a href=https://github.com/cortexproject/cortex/pull/2862>#2862</a></li><li>[ENHANCEMENT] Experimental: Querier can now optionally query secondary store. This is specified by using <code>-querier.second-store-engine</code> option, with values <code>chunks</code> or <code>blocks</code>. Standard configuration options for this store are used. Additionally, this querying can be configured to happen only for queries that need data older than <code>-querier.use-second-store-before-time</code>. Default value of zero will always query secondary store. <a href=https://github.com/cortexproject/cortex/pull/2747>#2747</a></li><li>[ENHANCEMENT] Query-tee: increased the <code>cortex_querytee_request_duration_seconds</code> metric buckets granularity. <a href=https://github.com/cortexproject/cortex/pull/2799>#2799</a></li><li>[ENHANCEMENT] Query-tee: fail to start if the configured <code>-backend.preferred</code> is unknown. <a href=https://github.com/cortexproject/cortex/pull/2799>#2799</a></li><li>[ENHANCEMENT] Ruler: Added the following metrics: <a href=https://github.com/cortexproject/cortex/pull/2786>#2786</a><ul><li><code>cortex_prometheus_notifications_latency_seconds</code></li><li><code>cortex_prometheus_notifications_errors_total</code></li><li><code>cortex_prometheus_notifications_sent_total</code></li><li><code>cortex_prometheus_notifications_dropped_total</code></li><li><code>cortex_prometheus_notifications_queue_length</code></li><li><code>cortex_prometheus_notifications_queue_capacity</code></li><li><code>cortex_prometheus_notifications_alertmanagers_discovered</code></li></ul></li><li>[ENHANCEMENT] The behavior of the <code>/ready</code> was changed for the query frontend to indicate when it was ready to accept queries. This is intended for use by a read path load balancer that would want to wait for the frontend to have attached queriers before including it in the backend. <a href=https://github.com/cortexproject/cortex/pull/2733>#2733</a></li><li>[ENHANCEMENT] Experimental Delete Series: Add support for deletion of chunks for remaining stores. <a href=https://github.com/cortexproject/cortex/pull/2801>#2801</a></li><li>[ENHANCEMENT] Add <code>-modules</code> command line flag to list possible values for <code>-target</code>. Also, log warning if given target is internal component. <a href=https://github.com/cortexproject/cortex/pull/2752>#2752</a></li><li>[ENHANCEMENT] Added <code>-ingester.flush-on-shutdown-with-wal-enabled</code> option to enable chunks flushing even when WAL is enabled. <a href=https://github.com/cortexproject/cortex/pull/2780>#2780</a></li><li>[ENHANCEMENT] Query-tee: Support for custom API prefix by using <code>-server.path-prefix</code> option. <a href=https://github.com/cortexproject/cortex/pull/2814>#2814</a></li><li>[ENHANCEMENT] Query-tee: Forward <code>X-Scope-OrgId</code> header to backend, if present in the request. <a href=https://github.com/cortexproject/cortex/pull/2815>#2815</a></li><li>[ENHANCEMENT] Experimental blocks storage: Added <code>-experimental.blocks-storage.tsdb.head-compaction-idle-timeout</code> option to force compaction of data in memory into a block. <a href=https://github.com/cortexproject/cortex/pull/2803>#2803</a></li><li>[ENHANCEMENT] Experimental blocks storage: Added support for flushing blocks via <code>/flush</code>, <code>/shutdown</code> (previously these only worked for chunks storage) and by using <code>-experimental.blocks-storage.tsdb.flush-blocks-on-shutdown</code> option. <a href=https://github.com/cortexproject/cortex/pull/2794>#2794</a></li><li>[ENHANCEMENT] Experimental blocks storage: Added support to enforce max query time range length via <code>-store.max-query-length</code>. <a href=https://github.com/cortexproject/cortex/pull/2826>#2826</a></li><li>[ENHANCEMENT] Experimental blocks storage: Added support to limit the max number of chunks that can be fetched from the long-term storage while executing a query. The limit is enforced both in the querier and store-gateway, and is configurable via <code>-store.query-chunk-limit</code>. <a href=https://github.com/cortexproject/cortex/pull/2852>#2852</a> <a href=https://github.com/cortexproject/cortex/pull/2922>#2922</a></li><li>[ENHANCEMENT] Ingester: Added new metric <code>cortex_ingester_flush_series_in_progress</code> that reports number of ongoing flush-series operations. Useful when calling <code>/flush</code> handler: if <code>cortex_ingester_flush_queue_length + cortex_ingester_flush_series_in_progress</code> is 0, all flushes are finished. <a href=https://github.com/cortexproject/cortex/pull/2778>#2778</a></li><li>[ENHANCEMENT] Memberlist members can join cluster via SRV records. <a href=https://github.com/cortexproject/cortex/pull/2788>#2788</a></li><li>[ENHANCEMENT] Added configuration options for chunks s3 client. <a href=https://github.com/cortexproject/cortex/pull/2831>#2831</a><ul><li><code>s3.endpoint</code></li><li><code>s3.region</code></li><li><code>s3.access-key-id</code></li><li><code>s3.secret-access-key</code></li><li><code>s3.insecure</code></li><li><code>s3.sse-encryption</code></li><li><code>s3.http.idle-conn-timeout</code></li><li><code>s3.http.response-header-timeout</code></li><li><code>s3.http.insecure-skip-verify</code></li></ul></li><li>[ENHANCEMENT] Prometheus upgraded. <a href=https://github.com/cortexproject/cortex/pull/2798>#2798</a> <a href=https://github.com/cortexproject/cortex/pull/2849>#2849</a> <a href=https://github.com/cortexproject/cortex/pull/2867>#2867</a> <a href=https://github.com/cortexproject/cortex/pull/2902>#2902</a> <a href=https://github.com/cortexproject/cortex/pull/2918>#2918</a><ul><li>Optimized labels regex matchers for patterns containing literals (eg. <code>foo.*</code>, <code>.*foo</code>, <code>.*foo.*</code>)</li></ul></li><li>[ENHANCEMENT] Add metric <code>cortex_ruler_config_update_failures_total</code> to Ruler to track failures of loading rules files. <a href=https://github.com/cortexproject/cortex/pull/2857>#2857</a></li><li>[ENHANCEMENT] Experimental Alertmanager: Alertmanager configuration persisted to object storage using an experimental API that accepts and returns YAML-based Alertmanager configuration. <a href=https://github.com/cortexproject/cortex/pull/2768>#2768</a></li><li>[ENHANCEMENT] Ruler: <code>-ruler.alertmanager-url</code> now supports multiple URLs. Each URL is treated as a separate Alertmanager group. Support for multiple Alertmanagers in a group can be achieved by using DNS service discovery. <a href=https://github.com/cortexproject/cortex/pull/2851>#2851</a></li><li>[ENHANCEMENT] Experimental blocks storage: Cortex Flusher now works with blocks engine. Flusher needs to be provided with blocks-engine configuration, existing Flusher flags are not used (they are only relevant for chunks engine). Note that flush errors are only reported via log. <a href=https://github.com/cortexproject/cortex/pull/2877>#2877</a></li><li>[ENHANCEMENT] Flusher: Added <code>-flusher.exit-after-flush</code> option (defaults to true) to control whether Cortex should stop completely after Flusher has finished its work. <a href=https://github.com/cortexproject/cortex/pull/2877>#2877</a></li><li>[ENHANCEMENT] Added metrics <code>cortex_config_hash</code> and <code>cortex_runtime_config_hash</code> to expose hash of the currently active config file. <a href=https://github.com/cortexproject/cortex/pull/2874>#2874</a></li><li>[ENHANCEMENT] Logger: added JSON logging support, configured via the <code>-log.format=json</code> CLI flag or its respective YAML config option. <a href=https://github.com/cortexproject/cortex/pull/2386>#2386</a></li><li>[ENHANCEMENT] Added new flags <code>-bigtable.grpc-compression</code>, <code>-ingester.client.grpc-compression</code>, <code>-querier.frontend-client.grpc-compression</code> to configure compression used by gRPC. Valid values are <code>gzip</code>, <code>snappy</code>, or empty string (no compression, default). <a href=https://github.com/cortexproject/cortex/pull/2940>#2940</a></li><li>[ENHANCEMENT] Clarify limitations of the <code>/api/v1/series</code>, <code>/api/v1/labels</code> and <code>/api/v1/label/{name}/values</code> endpoints. <a href=https://github.com/cortexproject/cortex/pull/2953>#2953</a></li><li>[ENHANCEMENT] Ingester: added <code>Dropped</code> outcome to metric <code>cortex_ingester_flushing_dequeued_series_total</code>. <a href=https://github.com/cortexproject/cortex/pull/2998>#2998</a></li><li>[BUGFIX] Fixed a bug with <code>api/v1/query_range</code> where no responses would return null values for <code>result</code> and empty values for <code>resultType</code>. <a href=https://github.com/cortexproject/cortex/pull/2962>#2962</a></li><li>[BUGFIX] Fixed a bug in the index intersect code causing storage to return more chunks/series than required. <a href=https://github.com/cortexproject/cortex/pull/2796>#2796</a></li><li>[BUGFIX] Fixed the number of reported keys in the background cache queue. <a href=https://github.com/cortexproject/cortex/pull/2764>#2764</a></li><li>[BUGFIX] Fix race in processing of headers in sharded queries. <a href=https://github.com/cortexproject/cortex/pull/2762>#2762</a></li><li>[BUGFIX] Query Frontend: Do not re-split sharded requests around ingester boundaries. <a href=https://github.com/cortexproject/cortex/pull/2766>#2766</a></li><li>[BUGFIX] Experimental Delete Series: Fixed a problem with cache generation numbers prefixed to cache keys. <a href=https://github.com/cortexproject/cortex/pull/2800>#2800</a></li><li>[BUGFIX] Ingester: Flushing chunks via <code>/flush</code> endpoint could previously lead to panic, if chunks were already flushed before and then removed from memory during the flush caused by <code>/flush</code> handler. Immediate flush now doesn&rsquo;t cause chunks to be flushed again. Samples received during flush triggered via <code>/flush</code> handler are no longer discarded. <a href=https://github.com/cortexproject/cortex/pull/2778>#2778</a></li><li>[BUGFIX] Prometheus upgraded. <a href=https://github.com/cortexproject/cortex/pull/2849>#2849</a><ul><li>Fixed unknown symbol error during head compaction</li></ul></li><li>[BUGFIX] Fix panic when using cassandra as store for both index and delete requests. <a href=https://github.com/cortexproject/cortex/pull/2774>#2774</a></li><li>[BUGFIX] Experimental Delete Series: Fixed a data race in Purger. <a href=https://github.com/cortexproject/cortex/pull/2817>#2817</a></li><li>[BUGFIX] KV: Fixed a bug that triggered a panic due to metrics being registered with the same name but different labels when using a <code>multi</code> configured KV client. <a href=https://github.com/cortexproject/cortex/pull/2837>#2837</a></li><li>[BUGFIX] Query-frontend: Fix passing HTTP <code>Host</code> header if <code>-frontend.downstream-url</code> is configured. <a href=https://github.com/cortexproject/cortex/pull/2880>#2880</a></li><li>[BUGFIX] Ingester: Improve time-series distribution when <code>-experimental.distributor.user-subring-size</code> is enabled. <a href=https://github.com/cortexproject/cortex/pull/2887>#2887</a></li><li>[BUGFIX] Set content type to <code>application/x-protobuf</code> for remote_read responses. <a href=https://github.com/cortexproject/cortex/pull/2915>#2915</a></li><li>[BUGFIX] Fixed ruler and store-gateway instance registration in the ring (when sharding is enabled) when a new instance replaces abruptly terminated one, and the only difference between the two instances is the address. <a href=https://github.com/cortexproject/cortex/pull/2954>#2954</a></li><li>[BUGFIX] Fixed <code>Missing chunks and index config causing silent failure</code> Absence of chunks and index from schema config is not validated. <a href=https://github.com/cortexproject/cortex/pull/2732>#2732</a></li><li>[BUGFIX] Fix panic caused by KVs from boltdb being used beyond their life. <a href=https://github.com/cortexproject/cortex/pull/2971>#2971</a></li><li>[BUGFIX] Experimental blocks storage: <code>/api/v1/series</code>, <code>/api/v1/labels</code> and <code>/api/v1/label/{name}/values</code> only query the TSDB head regardless of the configured <code>-experimental.blocks-storage.tsdb.retention-period</code>. <a href=https://github.com/cortexproject/cortex/pull/2974>#2974</a></li><li>[BUGFIX] Ingester: Avoid indefinite checkpointing in case of surge in number of series. <a href=https://github.com/cortexproject/cortex/pull/2955>#2955</a></li><li>[BUGFIX] Querier: query /series from ingesters regardless the <code>-querier.query-ingesters-within</code> setting. <a href=https://github.com/cortexproject/cortex/pull/3035>#3035</a></li><li>[BUGFIX] Ruler: fixed an unintentional breaking change introduced in the ruler&rsquo;s <code>alertmanager_url</code> YAML config option, which changed the value from a string to a list of strings. <a href=https://github.com/cortexproject/cortex/pull/2989>#2989</a></li></ul><h2 id=120--2020-07-01>1.2.0 / 2020-07-01</h2><ul><li>[CHANGE] Metric <code>cortex_kv_request_duration_seconds</code> now includes <code>name</code> label to denote which client is being used as well as the <code>backend</code> label to denote the KV backend implementation in use. <a href=https://github.com/cortexproject/cortex/pull/2648>#2648</a></li><li>[CHANGE] Experimental Ruler: Rule groups persisted to object storage using the experimental API have an updated object key encoding to better handle special characters. Rule groups previously-stored using object storage must be renamed to the new format. <a href=https://github.com/cortexproject/cortex/pull/2646>#2646</a></li><li>[CHANGE] Query Frontend now uses Round Robin to choose a tenant queue to service next. <a href=https://github.com/cortexproject/cortex/pull/2553>#2553</a></li><li>[CHANGE] <code>-promql.lookback-delta</code> is now deprecated and has been replaced by <code>-querier.lookback-delta</code> along with <code>lookback_delta</code> entry under <code>querier</code> in the config file. <code>-promql.lookback-delta</code> will be removed in v1.4.0. <a href=https://github.com/cortexproject/cortex/pull/2604>#2604</a></li><li>[CHANGE] Experimental TSDB: removed <code>-experimental.tsdb.bucket-store.binary-index-header-enabled</code> flag. Now the binary index-header is always enabled.</li><li>[CHANGE] Experimental TSDB: Renamed index-cache metrics to use original metric names from Thanos, as Cortex is not aggregating them in any way: <a href=https://github.com/cortexproject/cortex/pull/2627>#2627</a><ul><li><code>cortex_&lt;service>_blocks_index_cache_items_evicted_total</code> => <code>thanos_store_index_cache_items_evicted_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_items_added_total</code> => <code>thanos_store_index_cache_items_added_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_requests_total</code> => <code>thanos_store_index_cache_requests_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_items_overflowed_total</code> => <code>thanos_store_index_cache_items_overflowed_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_hits_total</code> => <code>thanos_store_index_cache_hits_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_items</code> => <code>thanos_store_index_cache_items{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_items_size_bytes</code> => <code>thanos_store_index_cache_items_size_bytes{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_total_size_bytes</code> => <code>thanos_store_index_cache_total_size_bytes{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_memcached_operations_total</code> => <code>thanos_memcached_operations_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_memcached_operation_failures_total</code> => <code>thanos_memcached_operation_failures_total{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_memcached_operation_duration_seconds</code> => <code>thanos_memcached_operation_duration_seconds{name="index-cache"}</code></li><li><code>cortex_&lt;service>_blocks_index_cache_memcached_operation_skipped_total</code> => <code>thanos_memcached_operation_skipped_total{name="index-cache"}</code></li></ul></li><li>[CHANGE] Experimental TSDB: Renamed metrics in bucket stores: <a href=https://github.com/cortexproject/cortex/pull/2627>#2627</a><ul><li><code>cortex_&lt;service>_blocks_meta_syncs_total</code> => <code>cortex_blocks_meta_syncs_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_meta_sync_failures_total</code> => <code>cortex_blocks_meta_sync_failures_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_meta_sync_duration_seconds</code> => <code>cortex_blocks_meta_sync_duration_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_meta_sync_consistency_delay_seconds</code> => <code>cortex_blocks_meta_sync_consistency_delay_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_meta_synced</code> => <code>cortex_blocks_meta_synced{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_block_loads_total</code> => <code>cortex_bucket_store_block_loads_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_block_load_failures_total</code> => <code>cortex_bucket_store_block_load_failures_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_block_drops_total</code> => <code>cortex_bucket_store_block_drops_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_block_drop_failures_total</code> => <code>cortex_bucket_store_block_drop_failures_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_blocks_loaded</code> => <code>cortex_bucket_store_blocks_loaded{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_data_touched</code> => <code>cortex_bucket_store_series_data_touched{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_data_fetched</code> => <code>cortex_bucket_store_series_data_fetched{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_data_size_touched_bytes</code> => <code>cortex_bucket_store_series_data_size_touched_bytes{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_data_size_fetched_bytes</code> => <code>cortex_bucket_store_series_data_size_fetched_bytes{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_blocks_queried</code> => <code>cortex_bucket_store_series_blocks_queried{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_get_all_duration_seconds</code> => <code>cortex_bucket_store_series_get_all_duration_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_merge_duration_seconds</code> => <code>cortex_bucket_store_series_merge_duration_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_refetches_total</code> => <code>cortex_bucket_store_series_refetches_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_series_result_series</code> => <code>cortex_bucket_store_series_result_series{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_cached_postings_compressions_total</code> => <code>cortex_bucket_store_cached_postings_compressions_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_cached_postings_compression_errors_total</code> => <code>cortex_bucket_store_cached_postings_compression_errors_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_cached_postings_compression_time_seconds</code> => <code>cortex_bucket_store_cached_postings_compression_time_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_cached_postings_original_size_bytes_total</code> => <code>cortex_bucket_store_cached_postings_original_size_bytes_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_bucket_store_cached_postings_compressed_size_bytes_total</code> => <code>cortex_bucket_store_cached_postings_compressed_size_bytes_total{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_sync_seconds</code> => <code>cortex_bucket_stores_blocks_sync_seconds{component="&lt;service>"}</code></li><li><code>cortex_&lt;service>_blocks_last_successful_sync_timestamp_seconds</code> => <code>cortex_bucket_stores_blocks_last_successful_sync_timestamp_seconds{component="&lt;service>"}</code></li></ul></li><li>[CHANGE] Available command-line flags are printed to stdout, and only when requested via <code>-help</code>. Using invalid flag no longer causes printing of all available flags. <a href=https://github.com/cortexproject/cortex/pull/2691>#2691</a></li><li>[CHANGE] Experimental Memberlist ring: randomize gossip node names to avoid conflicts when running multiple clients on the same host, or reusing host names (eg. pods in statefulset). Node name randomization can be disabled by using <code>-memberlist.randomize-node-name=false</code>. <a href=https://github.com/cortexproject/cortex/pull/2715>#2715</a></li><li>[CHANGE] Memberlist KV client is no longer considered experimental. <a href=https://github.com/cortexproject/cortex/pull/2725>#2725</a></li><li>[CHANGE] Experimental Delete Series: Make delete request cancellation duration configurable. <a href=https://github.com/cortexproject/cortex/pull/2760>#2760</a></li><li>[CHANGE] Removed <code>-store.fullsize-chunks</code> option which was undocumented and unused (it broke ingester hand-overs). <a href=https://github.com/cortexproject/cortex/pull/2656>#2656</a></li><li>[CHANGE] Query with no metric name that has previously resulted in HTTP status code 500 now returns status code 422 instead. <a href=https://github.com/cortexproject/cortex/pull/2571>#2571</a></li><li>[FEATURE] TLS config options added for GRPC clients in Querier (Query-frontend client & Ingester client), Ruler, Store Gateway, as well as HTTP client in Config store client. <a href=https://github.com/cortexproject/cortex/pull/2502>#2502</a></li><li>[FEATURE] The flag <code>-frontend.max-cache-freshness</code> is now supported within the limits overrides, to specify per-tenant max cache freshness values. The corresponding YAML config parameter has been changed from <code>results_cache.max_freshness</code> to <code>limits_config.max_cache_freshness</code>. The legacy YAML config parameter (<code>results_cache.max_freshness</code>) will continue to be supported till Cortex release <code>v1.4.0</code>. <a href=https://github.com/cortexproject/cortex/pull/2609>#2609</a></li><li>[FEATURE] Experimental gRPC Store: Added support to 3rd parties index and chunk stores using gRPC client/server plugin mechanism. <a href=https://github.com/cortexproject/cortex/pull/2220>#2220</a></li><li>[FEATURE] Add <code>-cassandra.table-options</code> flag to customize table options of Cassandra when creating the index or chunk table. <a href=https://github.com/cortexproject/cortex/pull/2575>#2575</a></li><li>[ENHANCEMENT] Propagate GOPROXY value when building <code>build-image</code>. This is to help the builders building the code in a Network where default Go proxy is not accessible (e.g. when behind some corporate VPN). <a href=https://github.com/cortexproject/cortex/pull/2741>#2741</a></li><li>[ENHANCEMENT] Querier: Added metric <code>cortex_querier_request_duration_seconds</code> for all requests to the querier. <a href=https://github.com/cortexproject/cortex/pull/2708>#2708</a></li><li>[ENHANCEMENT] Cortex is now built with Go 1.14. <a href=https://github.com/cortexproject/cortex/pull/2480>#2480</a> <a href=https://github.com/cortexproject/cortex/pull/2749>#2749</a> <a href=https://github.com/cortexproject/cortex/pull/2753>#2753</a></li><li>[ENHANCEMENT] Experimental TSDB: added the following metrics to the ingester: <a href=https://github.com/cortexproject/cortex/pull/2580>#2580</a> <a href=https://github.com/cortexproject/cortex/pull/2583>#2583</a> <a href=https://github.com/cortexproject/cortex/pull/2589>#2589</a> <a href=https://github.com/cortexproject/cortex/pull/2654>#2654</a><ul><li><code>cortex_ingester_tsdb_appender_add_duration_seconds</code></li><li><code>cortex_ingester_tsdb_appender_commit_duration_seconds</code></li><li><code>cortex_ingester_tsdb_refcache_purge_duration_seconds</code></li><li><code>cortex_ingester_tsdb_compactions_total</code></li><li><code>cortex_ingester_tsdb_compaction_duration_seconds</code></li><li><code>cortex_ingester_tsdb_wal_fsync_duration_seconds</code></li><li><code>cortex_ingester_tsdb_wal_page_flushes_total</code></li><li><code>cortex_ingester_tsdb_wal_completed_pages_total</code></li><li><code>cortex_ingester_tsdb_wal_truncations_failed_total</code></li><li><code>cortex_ingester_tsdb_wal_truncations_total</code></li><li><code>cortex_ingester_tsdb_wal_writes_failed_total</code></li><li><code>cortex_ingester_tsdb_checkpoint_deletions_failed_total</code></li><li><code>cortex_ingester_tsdb_checkpoint_deletions_total</code></li><li><code>cortex_ingester_tsdb_checkpoint_creations_failed_total</code></li><li><code>cortex_ingester_tsdb_checkpoint_creations_total</code></li><li><code>cortex_ingester_tsdb_wal_truncate_duration_seconds</code></li><li><code>cortex_ingester_tsdb_head_active_appenders</code></li><li><code>cortex_ingester_tsdb_head_series_not_found_total</code></li><li><code>cortex_ingester_tsdb_head_chunks</code></li><li><code>cortex_ingester_tsdb_mmap_chunk_corruptions_total</code></li><li><code>cortex_ingester_tsdb_head_chunks_created_total</code></li><li><code>cortex_ingester_tsdb_head_chunks_removed_total</code></li></ul></li><li>[ENHANCEMENT] Experimental TSDB: added metrics useful to alert on critical conditions of the blocks storage: <a href=https://github.com/cortexproject/cortex/pull/2573>#2573</a><ul><li><code>cortex_compactor_last_successful_run_timestamp_seconds</code></li><li><code>cortex_querier_blocks_last_successful_sync_timestamp_seconds</code> (when store-gateway is disabled)</li><li><code>cortex_querier_blocks_last_successful_scan_timestamp_seconds</code> (when store-gateway is enabled)</li><li><code>cortex_storegateway_blocks_last_successful_sync_timestamp_seconds</code></li></ul></li><li>[ENHANCEMENT] Experimental TSDB: added the flag <code>-experimental.tsdb.wal-compression-enabled</code> to allow to enable TSDB WAL compression. <a href=https://github.com/cortexproject/cortex/pull/2585>#2585</a></li><li>[ENHANCEMENT] Experimental TSDB: Querier and store-gateway components can now use so-called &ldquo;caching bucket&rdquo;, which can currently cache fetched chunks into shared memcached server. <a href=https://github.com/cortexproject/cortex/pull/2572>#2572</a></li><li>[ENHANCEMENT] Ruler: Automatically remove unhealthy rulers from the ring. <a href=https://github.com/cortexproject/cortex/pull/2587>#2587</a></li><li>[ENHANCEMENT] Query-tee: added support to <code>/metadata</code>, <code>/alerts</code>, and <code>/rules</code> endpoints <a href=https://github.com/cortexproject/cortex/pull/2600>#2600</a></li><li>[ENHANCEMENT] Query-tee: added support to query results comparison between two different backends. The comparison is disabled by default and can be enabled via <code>-proxy.compare-responses=true</code>. <a href=https://github.com/cortexproject/cortex/pull/2611>#2611</a></li><li>[ENHANCEMENT] Query-tee: improved the query-tee to not wait all backend responses before sending back the response to the client. The query-tee now sends back to the client first successful response, while honoring the <code>-backend.preferred</code> option. <a href=https://github.com/cortexproject/cortex/pull/2702>#2702</a></li><li>[ENHANCEMENT] Thanos and Prometheus upgraded. <a href=https://github.com/cortexproject/cortex/pull/2602>#2602</a> <a href=https://github.com/cortexproject/cortex/pull/2604>#2604</a> <a href=https://github.com/cortexproject/cortex/pull/2634>#2634</a> <a href=https://github.com/cortexproject/cortex/pull/2659>#2659</a> <a href=https://github.com/cortexproject/cortex/pull/2686>#2686</a> <a href=https://github.com/cortexproject/cortex/pull/2756>#2756</a><ul><li>TSDB now holds less WAL files after Head Truncation.</li><li>TSDB now does memory-mapping of Head chunks and reduces memory usage.</li></ul></li><li>[ENHANCEMENT] Experimental TSDB: decoupled blocks deletion from blocks compaction in the compactor, so that blocks deletion is not blocked by a busy compactor. The following metrics have been added: <a href=https://github.com/cortexproject/cortex/pull/2623>#2623</a><ul><li><code>cortex_compactor_block_cleanup_started_total</code></li><li><code>cortex_compactor_block_cleanup_completed_total</code></li><li><code>cortex_compactor_block_cleanup_failed_total</code></li><li><code>cortex_compactor_block_cleanup_last_successful_run_timestamp_seconds</code></li></ul></li><li>[ENHANCEMENT] Experimental TSDB: Use shared cache for metadata. This is especially useful when running multiple querier and store-gateway components to reduce number of object store API calls. <a href=https://github.com/cortexproject/cortex/pull/2626>#2626</a> <a href=https://github.com/cortexproject/cortex/pull/2640>#2640</a></li><li>[ENHANCEMENT] Experimental TSDB: when <code>-querier.query-store-after</code> is configured and running the experimental blocks storage, the time range of the query sent to the store is now manipulated to ensure the query end time is not more recent than &lsquo;now - query-store-after&rsquo;. <a href=https://github.com/cortexproject/cortex/pull/2642>#2642</a></li><li>[ENHANCEMENT] Experimental TSDB: small performance improvement in concurrent usage of RefCache, used during samples ingestion. <a href=https://github.com/cortexproject/cortex/pull/2651>#2651</a></li><li>[ENHANCEMENT] The following endpoints now respond appropriately to an <code>Accept</code> header with the value <code>application/json</code> <a href=https://github.com/cortexproject/cortex/pull/2673>#2673</a><ul><li><code>/distributor/all_user_stats</code></li><li><code>/distributor/ha_tracker</code></li><li><code>/ingester/ring</code></li><li><code>/store-gateway/ring</code></li><li><code>/compactor/ring</code></li><li><code>/ruler/ring</code></li><li><code>/services</code></li></ul></li><li>[ENHANCEMENT] Experimental Cassandra backend: Add <code>-cassandra.num-connections</code> to allow increasing the number of TCP connections to each Cassandra server. <a href=https://github.com/cortexproject/cortex/pull/2666>#2666</a></li><li>[ENHANCEMENT] Experimental Cassandra backend: Use separate Cassandra clients and connections for reads and writes. <a href=https://github.com/cortexproject/cortex/pull/2666>#2666</a></li><li>[ENHANCEMENT] Experimental Cassandra backend: Add <code>-cassandra.reconnect-interval</code> to allow specifying the reconnect interval to a Cassandra server that has been marked <code>DOWN</code> by the gocql driver. Also change the default value of the reconnect interval from <code>60s</code> to <code>1s</code>. <a href=https://github.com/cortexproject/cortex/pull/2687>#2687</a></li><li>[ENHANCEMENT] Experimental Cassandra backend: Add option <code>-cassandra.convict-hosts-on-failure=false</code> to not convict host of being down when a request fails. <a href=https://github.com/cortexproject/cortex/pull/2684>#2684</a></li><li>[ENHANCEMENT] Experimental TSDB: Applied a jitter to the period bucket scans in order to better distribute bucket operations over the time and increase the probability of hitting the shared cache (if configured). <a href=https://github.com/cortexproject/cortex/pull/2693>#2693</a></li><li>[ENHANCEMENT] Experimental TSDB: Series limit per user and per metric now work in TSDB blocks. <a href=https://github.com/cortexproject/cortex/pull/2676>#2676</a></li><li>[ENHANCEMENT] Experimental Memberlist: Added ability to periodically rejoin the memberlist cluster. <a href=https://github.com/cortexproject/cortex/pull/2724>#2724</a></li><li>[ENHANCEMENT] Experimental Delete Series: Added the following metrics for monitoring processing of delete requests: <a href=https://github.com/cortexproject/cortex/pull/2730>#2730</a><ul><li><code>cortex_purger_load_pending_requests_attempts_total</code>: Number of attempts that were made to load pending requests with status.</li><li><code>cortex_purger_oldest_pending_delete_request_age_seconds</code>: Age of oldest pending delete request in seconds.</li><li><code>cortex_purger_pending_delete_requests_count</code>: Count of requests which are in process or are ready to be processed.</li></ul></li><li>[ENHANCEMENT] Experimental TSDB: Improved compactor to hard-delete also partial blocks with an deletion mark (even if the deletion mark threshold has not been reached). <a href=https://github.com/cortexproject/cortex/pull/2751>#2751</a></li><li>[ENHANCEMENT] Experimental TSDB: Introduced a consistency check done by the querier to ensure all expected blocks have been queried via the store-gateway. If a block is missing on a store-gateway, the querier retries fetching series from missing blocks up to 3 times. If the consistency check fails once all retries have been exhausted, the query execution fails. The following metrics have been added: <a href=https://github.com/cortexproject/cortex/pull/2593>#2593</a> <a href=https://github.com/cortexproject/cortex/pull/2630>#2630</a> <a href=https://github.com/cortexproject/cortex/pull/2689>#2689</a> <a href=https://github.com/cortexproject/cortex/pull/2695>#2695</a><ul><li><code>cortex_querier_blocks_consistency_checks_total</code></li><li><code>cortex_querier_blocks_consistency_checks_failed_total</code></li><li><code>cortex_querier_storegateway_refetches_per_query</code></li></ul></li><li>[ENHANCEMENT] Delete requests can now be canceled <a href=https://github.com/cortexproject/cortex/pull/2555>#2555</a></li><li>[ENHANCEMENT] Table manager can now provision tables for delete store <a href=https://github.com/cortexproject/cortex/pull/2546>#2546</a></li><li>[BUGFIX] Ruler: Ensure temporary rule files with special characters are properly mapped and cleaned up. <a href=https://github.com/cortexproject/cortex/pull/2506>#2506</a></li><li>[BUGFIX] Fixes <a href=https://github.com/cortexproject/cortex/pull/2411>#2411</a>, Ensure requests are properly routed to the prometheus api embedded in the query if <code>-server.path-prefix</code> is set. <a href=https://github.com/cortexproject/cortex/pull/2372>#2372</a></li><li>[BUGFIX] Experimental TSDB: fixed chunk data corruption when querying back series using the experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2400>#2400</a></li><li>[BUGFIX] Fixed collection of tracing spans from Thanos components used internally. <a href=https://github.com/cortexproject/cortex/pull/2655>#2655</a></li><li>[BUGFIX] Experimental TSDB: fixed memory leak in ingesters. <a href=https://github.com/cortexproject/cortex/pull/2586>#2586</a></li><li>[BUGFIX] QueryFrontend: fixed a situation where HTTP error is ignored and an incorrect status code is set. <a href=https://github.com/cortexproject/cortex/pull/2590>#2590</a></li><li>[BUGFIX] Ingester: Fix an ingester starting up in the JOINING state and staying there forever. <a href=https://github.com/cortexproject/cortex/pull/2565>#2565</a></li><li>[BUGFIX] QueryFrontend: fixed a panic (<code>integer divide by zero</code>) in the query-frontend. The query-frontend now requires the <code>-querier.default-evaluation-interval</code> config to be set to the same value of the querier. <a href=https://github.com/cortexproject/cortex/pull/2614>#2614</a></li><li>[BUGFIX] Experimental TSDB: when the querier receives a <code>/series</code> request with a time range older than the data stored in the ingester, it now ignores the requested time range and returns known series anyway instead of returning an empty response. This aligns the behaviour with the chunks storage. <a href=https://github.com/cortexproject/cortex/pull/2617>#2617</a></li><li>[BUGFIX] Cassandra: fixed an edge case leading to an invalid CQL query when querying the index on a Cassandra store. <a href=https://github.com/cortexproject/cortex/pull/2639>#2639</a></li><li>[BUGFIX] Ingester: increment series per metric when recovering from WAL or transfer. <a href=https://github.com/cortexproject/cortex/pull/2674>#2674</a></li><li>[BUGFIX] Fixed <code>wrong number of arguments for 'mget' command</code> Redis error when a query has no chunks to lookup from storage. <a href=https://github.com/cortexproject/cortex/pull/2700>#2700</a> <a href=https://github.com/cortexproject/cortex/pull/2796>#2796</a></li><li>[BUGFIX] Ingester: Automatically remove old tmp checkpoints, fixing a potential disk space leak after an ingester crashes. <a href=https://github.com/cortexproject/cortex/pull/2726>#2726</a></li></ul><h2 id=110--2020-05-21>1.1.0 / 2020-05-21</h2><p>This release brings the usual mix of bugfixes and improvements. The biggest change is that WAL support for chunks is now considered to be production-ready!</p><p>Please make sure to review renamed metrics, and update your dashboards and alerts accordingly.</p><ul><li>[CHANGE] Added v1 API routes documented in <a href=https://github.com/cortexproject/cortex/pull/2327>#2327</a>. <a href=https://github.com/cortexproject/cortex/pull/2372>#2372</a><ul><li>Added <code>-http.alertmanager-http-prefix</code> flag which allows the configuration of the path where the Alertmanager API and UI can be reached. The default is set to <code>/alertmanager</code>.</li><li>Added <code>-http.prometheus-http-prefix</code> flag which allows the configuration of the path where the Prometheus API and UI can be reached. The default is set to <code>/prometheus</code>.</li><li>Updated the index hosted at the root prefix to point to the updated routes.</li><li>Legacy routes hardcoded with the <code>/api/prom</code> prefix now respect the <code>-http.prefix</code> flag.</li></ul></li><li>[CHANGE] The metrics <code>cortex_distributor_ingester_appends_total</code> and <code>distributor_ingester_append_failures_total</code> now include a <code>type</code> label to differentiate between <code>samples</code> and <code>metadata</code>. <a href=https://github.com/cortexproject/cortex/pull/2336>#2336</a></li><li>[CHANGE] The metrics for number of chunks and bytes flushed to the chunk store are renamed. Note that previous metrics were counted pre-deduplication, while new metrics are counted after deduplication. <a href=https://github.com/cortexproject/cortex/pull/2463>#2463</a><ul><li><code>cortex_ingester_chunks_stored_total</code> > <code>cortex_chunk_store_stored_chunks_total</code></li><li><code>cortex_ingester_chunk_stored_bytes_total</code> > <code>cortex_chunk_store_stored_chunk_bytes_total</code></li></ul></li><li>[CHANGE] Experimental TSDB: renamed blocks meta fetcher metrics: <a href=https://github.com/cortexproject/cortex/pull/2375>#2375</a><ul><li><code>cortex_querier_bucket_store_blocks_meta_syncs_total</code> > <code>cortex_querier_blocks_meta_syncs_total</code></li><li><code>cortex_querier_bucket_store_blocks_meta_sync_failures_total</code> > <code>cortex_querier_blocks_meta_sync_failures_total</code></li><li><code>cortex_querier_bucket_store_blocks_meta_sync_duration_seconds</code> > <code>cortex_querier_blocks_meta_sync_duration_seconds</code></li><li><code>cortex_querier_bucket_store_blocks_meta_sync_consistency_delay_seconds</code> > <code>cortex_querier_blocks_meta_sync_consistency_delay_seconds</code></li></ul></li><li>[CHANGE] Experimental TSDB: Modified default values for <code>compactor.deletion-delay</code> option from 48h to 12h and <code>-experimental.tsdb.bucket-store.ignore-deletion-marks-delay</code> from 24h to 6h. <a href=https://github.com/cortexproject/cortex/pull/2414>#2414</a></li><li>[CHANGE] WAL: Default value of <code>-ingester.checkpoint-enabled</code> changed to <code>true</code>. <a href=https://github.com/cortexproject/cortex/pull/2416>#2416</a></li><li>[CHANGE] <code>trace_id</code> field in log files has been renamed to <code>traceID</code>. <a href=https://github.com/cortexproject/cortex/pull/2518>#2518</a></li><li>[CHANGE] Slow query log has a different output now. Previously used <code>url</code> field has been replaced with <code>host</code> and <code>path</code>, and query parameters are logged as individual log fields with <code>qs_</code> prefix. <a href=https://github.com/cortexproject/cortex/pull/2520>#2520</a></li><li>[CHANGE] WAL: WAL and checkpoint compression is now disabled. <a href=https://github.com/cortexproject/cortex/pull/2436>#2436</a></li><li>[CHANGE] Update in dependency <code>go-kit/kit</code> from <code>v0.9.0</code> to <code>v0.10.0</code>. HTML escaping disabled in JSON Logger. <a href=https://github.com/cortexproject/cortex/pull/2535>#2535</a></li><li>[CHANGE] Experimental TSDB: Removed <code>cortex_&lt;service>_</code> prefix from Thanos objstore metrics and added <code>component</code> label to distinguish which Cortex component is doing API calls to the object storage when running in single-binary mode: <a href=https://github.com/cortexproject/cortex/pull/2568>#2568</a><ul><li><code>cortex_&lt;service>_thanos_objstore_bucket_operations_total</code> renamed to <code>thanos_objstore_bucket_operations_total{component="&lt;name>"}</code></li><li><code>cortex_&lt;service>_thanos_objstore_bucket_operation_failures_total</code> renamed to <code>thanos_objstore_bucket_operation_failures_total{component="&lt;name>"}</code></li><li><code>cortex_&lt;service>_thanos_objstore_bucket_operation_duration_seconds</code> renamed to <code>thanos_objstore_bucket_operation_duration_seconds{component="&lt;name>"}</code></li><li><code>cortex_&lt;service>_thanos_objstore_bucket_last_successful_upload_time</code> renamed to <code>thanos_objstore_bucket_last_successful_upload_time{component="&lt;name>"}</code></li></ul></li><li>[CHANGE] FIFO cache: The <code>-&lt;prefix>.fifocache.size</code> CLI flag has been renamed to <code>-&lt;prefix>.fifocache.max-size-items</code> as well as its YAML config option <code>size</code> renamed to <code>max_size_items</code>. <a href=https://github.com/cortexproject/cortex/pull/2319>#2319</a></li><li>[FEATURE] Ruler: The <code>-ruler.evaluation-delay</code> flag was added to allow users to configure a default evaluation delay for all rules in cortex. The default value is 0 which is the current behavior. <a href=https://github.com/cortexproject/cortex/pull/2423>#2423</a></li><li>[FEATURE] Experimental: Added a new object storage client for OpenStack Swift. <a href=https://github.com/cortexproject/cortex/pull/2440>#2440</a></li><li>[FEATURE] TLS config options added to the Server. <a href=https://github.com/cortexproject/cortex/pull/2535>#2535</a></li><li>[FEATURE] Experimental: Added support for <code>/api/v1/metadata</code> Prometheus-based endpoint. <a href=https://github.com/cortexproject/cortex/pull/2549>#2549</a></li><li>[FEATURE] Add ability to limit concurrent queries to Cassandra with <code>-cassandra.query-concurrency</code> flag. <a href=https://github.com/cortexproject/cortex/pull/2562>#2562</a></li><li>[FEATURE] Experimental TSDB: Introduced store-gateway service used by the experimental blocks storage to load and query blocks. The store-gateway optionally supports blocks sharding and replication via a dedicated hash ring, configurable via <code>-experimental.store-gateway.sharding-enabled</code> and <code>-experimental.store-gateway.sharding-ring.*</code> flags. The following metrics have been added: <a href=https://github.com/cortexproject/cortex/pull/2433>#2433</a> <a href=https://github.com/cortexproject/cortex/pull/2458>#2458</a> <a href=https://github.com/cortexproject/cortex/pull/2469>#2469</a> <a href=https://github.com/cortexproject/cortex/pull/2523>#2523</a><ul><li><code>cortex_querier_storegateway_instances_hit_per_query</code></li></ul></li><li>[ENHANCEMENT] Experimental TSDB: sample ingestion errors are now reported via existing <code>cortex_discarded_samples_total</code> metric. <a href=https://github.com/cortexproject/cortex/pull/2370>#2370</a></li><li>[ENHANCEMENT] Failures on samples at distributors and ingesters return the first validation error as opposed to the last. <a href=https://github.com/cortexproject/cortex/pull/2383>#2383</a></li><li>[ENHANCEMENT] Experimental TSDB: Added <code>cortex_querier_blocks_meta_synced</code>, which reflects current state of synced blocks over all tenants. <a href=https://github.com/cortexproject/cortex/pull/2392>#2392</a></li><li>[ENHANCEMENT] Added <code>cortex_distributor_latest_seen_sample_timestamp_seconds</code> metric to see how far behind Prometheus servers are in sending data. <a href=https://github.com/cortexproject/cortex/pull/2371>#2371</a></li><li>[ENHANCEMENT] FIFO cache to support eviction based on memory usage. Added <code>-&lt;prefix>.fifocache.max-size-bytes</code> CLI flag and YAML config option <code>max_size_bytes</code> to specify memory limit of the cache. <a href=https://github.com/cortexproject/cortex/pull/2319>#2319</a>, <a href=https://github.com/cortexproject/cortex/pull/2527>#2527</a></li><li>[ENHANCEMENT] Added <code>-querier.worker-match-max-concurrent</code>. Force worker concurrency to match the <code>-querier.max-concurrent</code> option. Overrides <code>-querier.worker-parallelism</code>. <a href=https://github.com/cortexproject/cortex/pull/2456>#2456</a></li><li>[ENHANCEMENT] Added the following metrics for monitoring delete requests: <a href=https://github.com/cortexproject/cortex/pull/2445>#2445</a><ul><li><code>cortex_purger_delete_requests_received_total</code>: Number of delete requests received per user.</li><li><code>cortex_purger_delete_requests_processed_total</code>: Number of delete requests processed per user.</li><li><code>cortex_purger_delete_requests_chunks_selected_total</code>: Number of chunks selected while building delete plans per user.</li><li><code>cortex_purger_delete_requests_processing_failures_total</code>: Number of delete requests processing failures per user.</li></ul></li><li>[ENHANCEMENT] Single Binary: Added query-frontend to the single binary. Single binary users will now benefit from various query-frontend features. Primarily: sharding, parallelization, load shedding, additional caching (if configured), and query retries. <a href=https://github.com/cortexproject/cortex/pull/2437>#2437</a></li><li>[ENHANCEMENT] Allow 1w (where w denotes week) and 1y (where y denotes year) when setting <code>-store.cache-lookups-older-than</code> and <code>-store.max-look-back-period</code>. <a href=https://github.com/cortexproject/cortex/pull/2454>#2454</a></li><li>[ENHANCEMENT] Optimize index queries for matchers using &ldquo;a|b|c&rdquo;-type regex. <a href=https://github.com/cortexproject/cortex/pull/2446>#2446</a> <a href=https://github.com/cortexproject/cortex/pull/2475>#2475</a></li><li>[ENHANCEMENT] Added per tenant metrics for queries and chunks and bytes read from chunk store: <a href=https://github.com/cortexproject/cortex/pull/2463>#2463</a><ul><li><code>cortex_chunk_store_fetched_chunks_total</code> and <code>cortex_chunk_store_fetched_chunk_bytes_total</code></li><li><code>cortex_query_frontend_queries_total</code> (per tenant queries counted by the frontend)</li></ul></li><li>[ENHANCEMENT] WAL: New metrics <code>cortex_ingester_wal_logged_bytes_total</code> and <code>cortex_ingester_checkpoint_logged_bytes_total</code> added to track total bytes logged to disk for WAL and checkpoints. <a href=https://github.com/cortexproject/cortex/pull/2497>#2497</a></li><li>[ENHANCEMENT] Add de-duplicated chunks counter <code>cortex_chunk_store_deduped_chunks_total</code> which counts every chunk not sent to the store because it was already sent by another replica. <a href=https://github.com/cortexproject/cortex/pull/2485>#2485</a></li><li>[ENHANCEMENT] Query-frontend now also logs the POST data of long queries. <a href=https://github.com/cortexproject/cortex/pull/2481>#2481</a></li><li>[ENHANCEMENT] WAL: Ingester WAL records now have type header and the custom WAL records have been replaced by Prometheus TSDB&rsquo;s WAL records. Old records will not be supported from 1.3 onwards. Note: once this is deployed, you cannot downgrade without data loss. <a href=https://github.com/cortexproject/cortex/pull/2436>#2436</a></li><li>[ENHANCEMENT] Redis Cache: Added <code>idle_timeout</code>, <code>wait_on_pool_exhaustion</code> and <code>max_conn_lifetime</code> options to redis cache configuration. <a href=https://github.com/cortexproject/cortex/pull/2550>#2550</a></li><li>[ENHANCEMENT] WAL: the experimental tag has been removed on the WAL in ingesters. <a href=https://github.com/cortexproject/cortex/pull/2560>#2560</a></li><li>[ENHANCEMENT] Use newer AWS API for paginated queries - removes &lsquo;Deprecated&rsquo; message from logfiles. <a href=https://github.com/cortexproject/cortex/pull/2452>#2452</a></li><li>[ENHANCEMENT] Experimental memberlist: Add retry with backoff on memberlist join other members. <a href=https://github.com/cortexproject/cortex/pull/2705>#2705</a></li><li>[ENHANCEMENT] Experimental TSDB: when the store-gateway sharding is enabled, unhealthy store-gateway instances are automatically removed from the ring after 10 consecutive <code>-experimental.store-gateway.sharding-ring.heartbeat-timeout</code> periods. <a href=https://github.com/cortexproject/cortex/pull/2526>#2526</a></li><li>[BUGFIX] Ruler: Ensure temporary rule files with special characters are properly mapped and cleaned up. <a href=https://github.com/cortexproject/cortex/pull/2506>#2506</a></li><li>[BUGFIX] Ensure requests are properly routed to the prometheus api embedded in the query if <code>-server.path-prefix</code> is set. Fixes <a href=https://github.com/cortexproject/cortex/pull/2411>#2411</a>. <a href=https://github.com/cortexproject/cortex/pull/2372>#2372</a></li><li>[BUGFIX] Experimental TSDB: Fixed chunk data corruption when querying back series using the experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2400>#2400</a></li><li>[BUGFIX] Cassandra Storage: Fix endpoint TLS host verification. <a href=https://github.com/cortexproject/cortex/pull/2109>#2109</a></li><li>[BUGFIX] Experimental TSDB: Fixed response status code from <code>422</code> to <code>500</code> when an error occurs while iterating chunks with the experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2402>#2402</a></li><li>[BUGFIX] Ring: Fixed a situation where upgrading from pre-1.0 cortex with a rolling strategy caused new 1.0 ingesters to lose their zone value in the ring until manually forced to re-register. <a href=https://github.com/cortexproject/cortex/pull/2404>#2404</a></li><li>[BUGFIX] Distributor: <code>/all_user_stats</code> now show API and Rule Ingest Rate correctly. <a href=https://github.com/cortexproject/cortex/pull/2457>#2457</a></li><li>[BUGFIX] Fixed <code>version</code>, <code>revision</code> and <code>branch</code> labels exported by the <code>cortex_build_info</code> metric. <a href=https://github.com/cortexproject/cortex/pull/2468>#2468</a></li><li>[BUGFIX] QueryFrontend: fixed a situation where span context missed when downstream_url is used. <a href=https://github.com/cortexproject/cortex/pull/2539>#2539</a></li><li>[BUGFIX] Querier: Fixed a situation where querier would crash because of an unresponsive frontend instance. <a href=https://github.com/cortexproject/cortex/pull/2569>#2569</a></li></ul><h2 id=101--2020-04-23>1.0.1 / 2020-04-23</h2><ul><li>[BUGFIX] Fix gaps when querying ingesters with replication factor = 3 and 2 ingesters in the cluster. <a href=https://github.com/cortexproject/cortex/pull/2503>#2503</a></li></ul><h2 id=100--2020-04-02>1.0.0 / 2020-04-02</h2><p>This is the first major release of Cortex. We made a lot of <strong>breaking changes</strong> in this release which have been detailed below. Please also see the stability guarantees we provide as part of a major release: <a href=https://cortexmetrics.io/docs/configuration/v1guarantees/>https://cortexmetrics.io/docs/configuration/v1guarantees/</a></p><ul><li><p>[CHANGE] Remove the following deprecated flags: <a href=https://github.com/cortexproject/cortex/pull/2339>#2339</a></p><ul><li><code>-metrics.error-rate-query</code> (use <code>-metrics.write-throttle-query</code> instead).</li><li><code>-store.cardinality-cache-size</code> (use <code>-store.index-cache-read.enable-fifocache</code> and <code>-store.index-cache-read.fifocache.size</code> instead).</li><li><code>-store.cardinality-cache-validity</code> (use <code>-store.index-cache-read.enable-fifocache</code> and <code>-store.index-cache-read.fifocache.duration</code> instead).</li><li><code>-distributor.limiter-reload-period</code> (flag unused)</li><li><code>-ingester.claim-on-rollout</code> (flag unused)</li><li><code>-ingester.normalise-tokens</code> (flag unused)</li></ul></li><li><p>[CHANGE] Renamed YAML file options to be more consistent. See <a href=#config-file-breaking-changes>full config file changes below</a>. <a href=https://github.com/cortexproject/cortex/pull/2273>#2273</a></p></li><li><p>[CHANGE] AWS based autoscaling has been removed. You can only use metrics based autoscaling now. <code>-applicationautoscaling.url</code> has been removed. See <a href=https://cortexmetrics.io/docs/production/aws/#dynamodb-capacity-provisioning>https://cortexmetrics.io/docs/production/aws/#dynamodb-capacity-provisioning</a> on how to migrate. <a href=https://github.com/cortexproject/cortex/pull/2328>#2328</a></p></li><li><p>[CHANGE] Renamed the <code>memcache.write-back-goroutines</code> and <code>memcache.write-back-buffer</code> flags to <code>background.write-back-concurrency</code> and <code>background.write-back-buffer</code>. This affects the following flags: <a href=https://github.com/cortexproject/cortex/pull/2241>#2241</a></p><ul><li><code>-frontend.memcache.write-back-buffer</code> &ndash;> <code>-frontend.background.write-back-buffer</code></li><li><code>-frontend.memcache.write-back-goroutines</code> &ndash;> <code>-frontend.background.write-back-concurrency</code></li><li><code>-store.index-cache-read.memcache.write-back-buffer</code> &ndash;> <code>-store.index-cache-read.background.write-back-buffer</code></li><li><code>-store.index-cache-read.memcache.write-back-goroutines</code> &ndash;> <code>-store.index-cache-read.background.write-back-concurrency</code></li><li><code>-store.index-cache-write.memcache.write-back-buffer</code> &ndash;> <code>-store.index-cache-write.background.write-back-buffer</code></li><li><code>-store.index-cache-write.memcache.write-back-goroutines</code> &ndash;> <code>-store.index-cache-write.background.write-back-concurrency</code></li><li><code>-memcache.write-back-buffer</code> &ndash;> <code>-store.chunks-cache.background.write-back-buffer</code>. Note the next change log for the difference.</li><li><code>-memcache.write-back-goroutines</code> &ndash;> <code>-store.chunks-cache.background.write-back-concurrency</code>. Note the next change log for the difference.</li></ul></li><li><p>[CHANGE] Renamed the chunk cache flags to have <code>store.chunks-cache.</code> as prefix. This means the following flags have been changed: <a href=https://github.com/cortexproject/cortex/pull/2241>#2241</a></p><ul><li><code>-cache.enable-fifocache</code> &ndash;> <code>-store.chunks-cache.cache.enable-fifocache</code></li><li><code>-default-validity</code> &ndash;> <code>-store.chunks-cache.default-validity</code></li><li><code>-fifocache.duration</code> &ndash;> <code>-store.chunks-cache.fifocache.duration</code></li><li><code>-fifocache.size</code> &ndash;> <code>-store.chunks-cache.fifocache.size</code></li><li><code>-memcache.write-back-buffer</code> &ndash;> <code>-store.chunks-cache.background.write-back-buffer</code>. Note the previous change log for the difference.</li><li><code>-memcache.write-back-goroutines</code> &ndash;> <code>-store.chunks-cache.background.write-back-concurrency</code>. Note the previous change log for the difference.</li><li><code>-memcached.batchsize</code> &ndash;> <code>-store.chunks-cache.memcached.batchsize</code></li><li><code>-memcached.consistent-hash</code> &ndash;> <code>-store.chunks-cache.memcached.consistent-hash</code></li><li><code>-memcached.expiration</code> &ndash;> <code>-store.chunks-cache.memcached.expiration</code></li><li><code>-memcached.hostname</code> &ndash;> <code>-store.chunks-cache.memcached.hostname</code></li><li><code>-memcached.max-idle-conns</code> &ndash;> <code>-store.chunks-cache.memcached.max-idle-conns</code></li><li><code>-memcached.parallelism</code> &ndash;> <code>-store.chunks-cache.memcached.parallelism</code></li><li><code>-memcached.service</code> &ndash;> <code>-store.chunks-cache.memcached.service</code></li><li><code>-memcached.timeout</code> &ndash;> <code>-store.chunks-cache.memcached.timeout</code></li><li><code>-memcached.update-interval</code> &ndash;> <code>-store.chunks-cache.memcached.update-interval</code></li><li><code>-redis.enable-tls</code> &ndash;> <code>-store.chunks-cache.redis.enable-tls</code></li><li><code>-redis.endpoint</code> &ndash;> <code>-store.chunks-cache.redis.endpoint</code></li><li><code>-redis.expiration</code> &ndash;> <code>-store.chunks-cache.redis.expiration</code></li><li><code>-redis.max-active-conns</code> &ndash;> <code>-store.chunks-cache.redis.max-active-conns</code></li><li><code>-redis.max-idle-conns</code> &ndash;> <code>-store.chunks-cache.redis.max-idle-conns</code></li><li><code>-redis.password</code> &ndash;> <code>-store.chunks-cache.redis.password</code></li><li><code>-redis.timeout</code> &ndash;> <code>-store.chunks-cache.redis.timeout</code></li></ul></li><li><p>[CHANGE] Rename the <code>-store.chunk-cache-stubs</code> to <code>-store.chunks-cache.cache-stubs</code> to be more inline with above. <a href=https://github.com/cortexproject/cortex/pull/2241>#2241</a></p></li><li><p>[CHANGE] Change prefix of flags <code>-dynamodb.periodic-table.*</code> to <code>-table-manager.index-table.*</code>. <a href=https://github.com/cortexproject/cortex/pull/2359>#2359</a></p></li><li><p>[CHANGE] Change prefix of flags <code>-dynamodb.chunk-table.*</code> to <code>-table-manager.chunk-table.*</code>. <a href=https://github.com/cortexproject/cortex/pull/2359>#2359</a></p></li><li><p>[CHANGE] Change the following flags: <a href=https://github.com/cortexproject/cortex/pull/2359>#2359</a></p><ul><li><code>-dynamodb.poll-interval</code> &ndash;> <code>-table-manager.poll-interval</code></li><li><code>-dynamodb.periodic-table.grace-period</code> &ndash;> <code>-table-manager.periodic-table.grace-period</code></li></ul></li><li><p>[CHANGE] Renamed the following flags: <a href=https://github.com/cortexproject/cortex/pull/2273>#2273</a></p><ul><li><code>-dynamodb.chunk.gang.size</code> &ndash;> <code>-dynamodb.chunk-gang-size</code></li><li><code>-dynamodb.chunk.get.max.parallelism</code> &ndash;> <code>-dynamodb.chunk-get-max-parallelism</code></li></ul></li><li><p>[CHANGE] Don&rsquo;t support mixed time units anymore for duration. For example, 168h5m0s doesn&rsquo;t work anymore, please use just one unit (s|m|h|d|w|y). <a href=https://github.com/cortexproject/cortex/pull/2252>#2252</a></p></li><li><p>[CHANGE] Utilize separate protos for rule state and storage. Experimental ruler API will not be functional until the rollout is complete. <a href=https://github.com/cortexproject/cortex/pull/2226>#2226</a></p></li><li><p>[CHANGE] Frontend worker in querier now starts after all Querier module dependencies are started. This fixes issue where frontend worker started to send queries to querier before it was ready to serve them (mostly visible when using experimental blocks storage). <a href=https://github.com/cortexproject/cortex/pull/2246>#2246</a></p></li><li><p>[CHANGE] Lifecycler component now enters Failed state on errors, and doesn&rsquo;t exit the process. (Important if you&rsquo;re vendoring Cortex and use Lifecycler) <a href=https://github.com/cortexproject/cortex/pull/2251>#2251</a></p></li><li><p>[CHANGE] <code>/ready</code> handler now returns 200 instead of 204. <a href=https://github.com/cortexproject/cortex/pull/2330>#2330</a></p></li><li><p>[CHANGE] Better defaults for the following options: <a href=https://github.com/cortexproject/cortex/pull/2344>#2344</a></p><ul><li><code>-&lt;prefix>.consul.consistent-reads</code>: Old default: <code>true</code>, new default: <code>false</code>. This reduces the load on Consul.</li><li><code>-&lt;prefix>.consul.watch-rate-limit</code>: Old default: 0, new default: 1. This rate limits the reads to 1 per second. Which is good enough for ring watches.</li><li><code>-distributor.health-check-ingesters</code>: Old default: <code>false</code>, new default: <code>true</code>.</li><li><code>-ingester.max-stale-chunk-idle</code>: Old default: 0, new default: 2m. This lets us expire series that we know are stale early.</li><li><code>-ingester.spread-flushes</code>: Old default: false, new default: true. This allows to better de-duplicate data and use less space.</li><li><code>-ingester.chunk-age-jitter</code>: Old default: 20mins, new default: 0. This is to enable the <code>-ingester.spread-flushes</code> to true.</li><li><code>-&lt;prefix>.memcached.batchsize</code>: Old default: 0, new default: 1024. This allows batching of requests and keeps the concurrent requests low.</li><li><code>-&lt;prefix>.memcached.consistent-hash</code>: Old default: false, new default: true. This allows for better cache hits when the memcaches are scaled up and down.</li><li><code>-querier.batch-iterators</code>: Old default: false, new default: true.</li><li><code>-querier.ingester-streaming</code>: Old default: false, new default: true.</li></ul></li><li><p>[CHANGE] Experimental TSDB: Added <code>-experimental.tsdb.bucket-store.postings-cache-compression-enabled</code> to enable postings compression when storing to cache. <a href=https://github.com/cortexproject/cortex/pull/2335>#2335</a></p></li><li><p>[CHANGE] Experimental TSDB: Added <code>-compactor.deletion-delay</code>, which is time before a block marked for deletion is deleted from bucket. If not 0, blocks will be marked for deletion and compactor component will delete blocks marked for deletion from the bucket. If delete-delay is 0, blocks will be deleted straight away. Note that deleting blocks immediately can cause query failures, if store gateway / querier still has the block loaded, or compactor is ignoring the deletion because it&rsquo;s compacting the block at the same time. Default value is 48h. <a href=https://github.com/cortexproject/cortex/pull/2335>#2335</a></p></li><li><p>[CHANGE] Experimental TSDB: Added <code>-experimental.tsdb.bucket-store.index-cache.postings-compression-enabled</code>, to set duration after which the blocks marked for deletion will be filtered out while fetching blocks used for querying. This option allows querier to ignore blocks that are marked for deletion with some delay. This ensures store can still serve blocks that are meant to be deleted but do not have a replacement yet. Default is 24h, half of the default value for <code>-compactor.deletion-delay</code>. <a href=https://github.com/cortexproject/cortex/pull/2335>#2335</a></p></li><li><p>[CHANGE] Experimental TSDB: Added <code>-experimental.tsdb.bucket-store.index-cache.memcached.max-item-size</code> to control maximum size of item that is stored to memcached. Defaults to 1 MiB. <a href=https://github.com/cortexproject/cortex/pull/2335>#2335</a></p></li><li><p>[FEATURE] Added experimental storage API to the ruler service that is enabled when the <code>-experimental.ruler.enable-api</code> is set to true <a href=https://github.com/cortexproject/cortex/pull/2269>#2269</a></p><ul><li><code>-ruler.storage.type</code> flag now allows <code>s3</code>,<code>gcs</code>, and <code>azure</code> values</li><li><code>-ruler.storage.(s3|gcs|azure)</code> flags exist to allow the configuration of object clients set for rule storage</li></ul></li><li><p>[CHANGE] Renamed table manager metrics. <a href=https://github.com/cortexproject/cortex/pull/2307>#2307</a> <a href=https://github.com/cortexproject/cortex/pull/2359>#2359</a></p><ul><li><code>cortex_dynamo_sync_tables_seconds</code> -> <code>cortex_table_manager_sync_duration_seconds</code></li><li><code>cortex_dynamo_table_capacity_units</code> -> <code>cortex_table_capacity_units</code></li></ul></li><li><p>[FEATURE] Flusher target to flush the WAL. <a href=https://github.com/cortexproject/cortex/pull/2075>#2075</a></p><ul><li><code>-flusher.wal-dir</code> for the WAL directory to recover from.</li><li><code>-flusher.concurrent-flushes</code> for number of concurrent flushes.</li><li><code>-flusher.flush-op-timeout</code> is duration after which a flush should timeout.</li></ul></li><li><p>[FEATURE] Ingesters can now have an optional availability zone set, to ensure metric replication is distributed across zones. This is set via the <code>-ingester.availability-zone</code> flag or the <code>availability_zone</code> field in the config file. <a href=https://github.com/cortexproject/cortex/pull/2317>#2317</a></p></li><li><p>[ENHANCEMENT] Better re-use of connections to DynamoDB and S3. <a href=https://github.com/cortexproject/cortex/pull/2268>#2268</a></p></li><li><p>[ENHANCEMENT] Reduce number of goroutines used while executing a single index query. <a href=https://github.com/cortexproject/cortex/pull/2280>#2280</a></p></li><li><p>[ENHANCEMENT] Experimental TSDB: Add support for local <code>filesystem</code> backend. <a href=https://github.com/cortexproject/cortex/pull/2245>#2245</a></p></li><li><p>[ENHANCEMENT] Experimental TSDB: Added memcached support for the TSDB index cache. <a href=https://github.com/cortexproject/cortex/pull/2290>#2290</a></p></li><li><p>[ENHANCEMENT] Experimental TSDB: Removed gRPC server to communicate between querier and BucketStore. <a href=https://github.com/cortexproject/cortex/pull/2324>#2324</a></p></li><li><p>[ENHANCEMENT] Allow 1w (where w denotes week) and 1y (where y denotes year) when setting table period and retention. <a href=https://github.com/cortexproject/cortex/pull/2252>#2252</a></p></li><li><p>[ENHANCEMENT] Added FIFO cache metrics for current number of entries and memory usage. <a href=https://github.com/cortexproject/cortex/pull/2270>#2270</a></p></li><li><p>[ENHANCEMENT] Output all config fields to /config API, including those with empty value. <a href=https://github.com/cortexproject/cortex/pull/2209>#2209</a></p></li><li><p>[ENHANCEMENT] Add &ldquo;missing_metric_name&rdquo; and &ldquo;metric_name_invalid&rdquo; reasons to cortex_discarded_samples_total metric. <a href=https://github.com/cortexproject/cortex/pull/2346>#2346</a></p></li><li><p>[ENHANCEMENT] Experimental TSDB: sample ingestion errors are now reported via existing <code>cortex_discarded_samples_total</code> metric. <a href=https://github.com/cortexproject/cortex/pull/2370>#2370</a></p></li><li><p>[BUGFIX] Ensure user state metrics are updated if a transfer fails. <a href=https://github.com/cortexproject/cortex/pull/2338>#2338</a></p></li><li><p>[BUGFIX] Fixed etcd client keepalive settings. <a href=https://github.com/cortexproject/cortex/pull/2278>#2278</a></p></li><li><p>[BUGFIX] Register the metrics of the WAL. <a href=https://github.com/cortexproject/cortex/pull/2295>#2295</a></p></li><li><p>[BUXFIX] Experimental TSDB: fixed error handling when ingesting out of bound samples. <a href=https://github.com/cortexproject/cortex/pull/2342>#2342</a></p></li></ul><h3 id=known-issues>Known issues</h3><ul><li>This experimental blocks storage in Cortex <code>1.0.0</code> has a bug which may lead to the error <code>cannot iterate chunk for series</code> when running queries. This bug has been fixed in <a href=https://github.com/cortexproject/cortex/pull/2400>#2400</a>. If you&rsquo;re running the experimental blocks storage, please build Cortex from <code>master</code>.</li></ul><h3 id=config-file-breaking-changes>Config file breaking changes</h3><p>In this section you can find a config file diff showing the breaking changes introduced in Cortex. You can also find the <a href=https://cortexmetrics.io/docs/configuration/configuration-file/>full configuration file reference doc</a> in the website.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff>### ingester_config

 # Period with which to attempt to flush chunks.
 # CLI flag: -ingester.flush-period
<span style=color:#a40000>-[flushcheckperiod: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[flush_period: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
 # Period chunks will remain in memory after flushing.
 # CLI flag: -ingester.retain-period
<span style=color:#a40000>-[retainperiod: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[retain_period: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#00a000></span>
 # Maximum chunk idle time before flushing.
 # CLI flag: -ingester.max-chunk-idle
<span style=color:#a40000>-[maxchunkidle: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[max_chunk_idle_time: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#00a000></span>
 # Maximum chunk idle time for chunks terminating in stale markers before
 # flushing. 0 disables it and a stale series is not flushed until the
 # max-chunk-idle timeout is reached.
 # CLI flag: -ingester.max-stale-chunk-idle
<span style=color:#a40000>-[maxstalechunkidle: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[max_stale_chunk_idle_time: &lt;duration&gt; | default = 2m0s]
</span><span style=color:#00a000></span>
 # Timeout for individual flush operations.
 # CLI flag: -ingester.flush-op-timeout
<span style=color:#a40000>-[flushoptimeout: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[flush_op_timeout: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
 # Maximum chunk age before flushing.
 # CLI flag: -ingester.max-chunk-age
<span style=color:#a40000>-[maxchunkage: &lt;duration&gt; | default = 12h0m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[max_chunk_age: &lt;duration&gt; | default = 12h0m0s]
</span><span style=color:#00a000></span>
<span style=color:#a40000>-# Range of time to subtract from MaxChunkAge to spread out flushes
</span><span style=color:#a40000></span><span style=color:#00a000>+# Range of time to subtract from -ingester.max-chunk-age to spread out flushes
</span><span style=color:#00a000></span> # CLI flag: -ingester.chunk-age-jitter
<span style=color:#a40000>-[chunkagejitter: &lt;duration&gt; | default = 20m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[chunk_age_jitter: &lt;duration&gt; | default = 0]
</span><span style=color:#00a000></span>
 # Number of concurrent goroutines flushing to dynamodb.
 # CLI flag: -ingester.concurrent-flushes
<span style=color:#a40000>-[concurrentflushes: &lt;int&gt; | default = 50]
</span><span style=color:#a40000></span><span style=color:#00a000>+[concurrent_flushes: &lt;int&gt; | default = 50]
</span><span style=color:#00a000></span>
<span style=color:#a40000>-# If true, spread series flushes across the whole period of MaxChunkAge
</span><span style=color:#a40000></span><span style=color:#00a000>+# If true, spread series flushes across the whole period of
</span><span style=color:#00a000>+# -ingester.max-chunk-age.
</span><span style=color:#00a000></span> # CLI flag: -ingester.spread-flushes
<span style=color:#a40000>-[spreadflushes: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[spread_flushes: &lt;boolean&gt; | default = true]
</span><span style=color:#00a000></span>
 # Period with which to update the per-user ingestion rates.
 # CLI flag: -ingester.rate-update-period
<span style=color:#a40000>-[rateupdateperiod: &lt;duration&gt; | default = 15s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[rate_update_period: &lt;duration&gt; | default = 15s]
</span><span style=color:#00a000></span>

### querier_config

 # The maximum number of concurrent queries.
 # CLI flag: -querier.max-concurrent
<span style=color:#a40000>-[maxconcurrent: &lt;int&gt; | default = 20]
</span><span style=color:#a40000></span><span style=color:#00a000>+[max_concurrent: &lt;int&gt; | default = 20]
</span><span style=color:#00a000></span>
 # Use batch iterators to execute query, as opposed to fully materialising the
 # series in memory.  Takes precedent over the -querier.iterators flag.
 # CLI flag: -querier.batch-iterators
<span style=color:#a40000>-[batchiterators: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[batch_iterators: &lt;boolean&gt; | default = true]
</span><span style=color:#00a000></span>
 # Use streaming RPCs to query ingester.
 # CLI flag: -querier.ingester-streaming
<span style=color:#a40000>-[ingesterstreaming: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[ingester_streaming: &lt;boolean&gt; | default = true]
</span><span style=color:#00a000></span>
 # Maximum number of samples a single query can load into memory.
 # CLI flag: -querier.max-samples
<span style=color:#a40000>-[maxsamples: &lt;int&gt; | default = 50000000]
</span><span style=color:#a40000></span><span style=color:#00a000>+[max_samples: &lt;int&gt; | default = 50000000]
</span><span style=color:#00a000></span>
 # The default evaluation interval or step size for subqueries.
 # CLI flag: -querier.default-evaluation-interval
<span style=color:#a40000>-[defaultevaluationinterval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[default_evaluation_interval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
### query_frontend_config

 # URL of downstream Prometheus.
 # CLI flag: -frontend.downstream-url
<span style=color:#a40000>-[downstream: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[downstream_url: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>

### ruler_config

 # URL of alerts return path.
 # CLI flag: -ruler.external.url
<span style=color:#a40000>-[externalurl: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span><span style=color:#00a000>+[external_url: &lt;url&gt; | default = ]
</span><span style=color:#00a000></span>
 # How frequently to evaluate rules
 # CLI flag: -ruler.evaluation-interval
<span style=color:#a40000>-[evaluationinterval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[evaluation_interval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
 # How frequently to poll for rule changes
 # CLI flag: -ruler.poll-interval
<span style=color:#a40000>-[pollinterval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[poll_interval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
<span style=color:#a40000>-storeconfig:
</span><span style=color:#a40000></span><span style=color:#00a000>+storage:
</span><span style=color:#00a000></span>
 # file path to store temporary rule files for the prometheus rule managers
 # CLI flag: -ruler.rule-path
<span style=color:#a40000>-[rulepath: &lt;string&gt; | default = &#34;/rules&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[rule_path: &lt;string&gt; | default = &#34;/rules&#34;]
</span><span style=color:#00a000></span>
 # URL of the Alertmanager to send notifications to.
 # CLI flag: -ruler.alertmanager-url
<span style=color:#a40000>-[alertmanagerurl: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span><span style=color:#00a000>+[alertmanager_url: &lt;url&gt; | default = ]
</span><span style=color:#00a000></span>
 # Use DNS SRV records to discover alertmanager hosts.
 # CLI flag: -ruler.alertmanager-discovery
<span style=color:#a40000>-[alertmanagerdiscovery: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[enable_alertmanager_discovery: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>
 # How long to wait between refreshing alertmanager hosts.
 # CLI flag: -ruler.alertmanager-refresh-interval
<span style=color:#a40000>-[alertmanagerrefreshinterval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[alertmanager_refresh_interval: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
 # If enabled requests to alertmanager will utilize the V2 API.
 # CLI flag: -ruler.alertmanager-use-v2
<span style=color:#a40000>-[alertmanangerenablev2api: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[enable_alertmanager_v2: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>
 # Capacity of the queue for notifications to be sent to the Alertmanager.
 # CLI flag: -ruler.notification-queue-capacity
<span style=color:#a40000>-[notificationqueuecapacity: &lt;int&gt; | default = 10000]
</span><span style=color:#a40000></span><span style=color:#00a000>+[notification_queue_capacity: &lt;int&gt; | default = 10000]
</span><span style=color:#00a000></span>
 # HTTP timeout duration when sending notifications to the Alertmanager.
 # CLI flag: -ruler.notification-timeout
<span style=color:#a40000>-[notificationtimeout: &lt;duration&gt; | default = 10s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[notification_timeout: &lt;duration&gt; | default = 10s]
</span><span style=color:#00a000></span>
 # Distribute rule evaluation using ring backend
 # CLI flag: -ruler.enable-sharding
<span style=color:#a40000>-[enablesharding: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+[enable_sharding: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>
 # Time to spend searching for a pending ruler when shutting down.
 # CLI flag: -ruler.search-pending-for
<span style=color:#a40000>-[searchpendingfor: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[search_pending_for: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#00a000></span>
 # Period with which to attempt to flush rule groups.
 # CLI flag: -ruler.flush-period
<span style=color:#a40000>-[flushcheckperiod: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[flush_period: &lt;duration&gt; | default = 1m0s]
</span><span style=color:#00a000></span>
### alertmanager_config

 # Base path for data storage.
 # CLI flag: -alertmanager.storage.path
<span style=color:#a40000>-[datadir: &lt;string&gt; | default = &#34;data/&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[data_dir: &lt;string&gt; | default = &#34;data/&#34;]
</span><span style=color:#00a000></span>
 # will be used to prefix all HTTP endpoints served by Alertmanager. If omitted,
 # relevant URL components will be derived automatically.
 # CLI flag: -alertmanager.web.external-url
<span style=color:#a40000>-[externalurl: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span><span style=color:#00a000>+[external_url: &lt;url&gt; | default = ]
</span><span style=color:#00a000></span>
 # How frequently to poll Cortex configs
 # CLI flag: -alertmanager.configs.poll-interval
<span style=color:#a40000>-[pollinterval: &lt;duration&gt; | default = 15s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[poll_interval: &lt;duration&gt; | default = 15s]
</span><span style=color:#00a000></span>
 # Listen address for cluster.
 # CLI flag: -cluster.listen-address
<span style=color:#a40000>-[clusterbindaddr: &lt;string&gt; | default = &#34;0.0.0.0:9094&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[cluster_bind_address: &lt;string&gt; | default = &#34;0.0.0.0:9094&#34;]
</span><span style=color:#00a000></span>
 # Explicit address to advertise in cluster.
 # CLI flag: -cluster.advertise-address
<span style=color:#a40000>-[clusteradvertiseaddr: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[cluster_advertise_address: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>
 # Time to wait between peers to send notifications.
 # CLI flag: -cluster.peer-timeout
<span style=color:#a40000>-[peertimeout: &lt;duration&gt; | default = 15s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[peer_timeout: &lt;duration&gt; | default = 15s]
</span><span style=color:#00a000></span>
 # Filename of fallback config to use if none specified for instance.
 # CLI flag: -alertmanager.configs.fallback
<span style=color:#a40000>-[fallbackconfigfile: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[fallback_config_file: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>
 # Root of URL to generate if config is http://internal.monitor
 # CLI flag: -alertmanager.configs.auto-webhook-root
<span style=color:#a40000>-[autowebhookroot: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[auto_webhook_root: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>
### table_manager_config

<span style=color:#a40000>-store:
</span><span style=color:#a40000></span><span style=color:#00a000>+storage:
</span><span style=color:#00a000></span>
<span style=color:#a40000>-# How frequently to poll DynamoDB to learn our capacity.
</span><span style=color:#a40000>-# CLI flag: -dynamodb.poll-interval
</span><span style=color:#a40000>-[dynamodb_poll_interval: &lt;duration&gt; | default = 2m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+# How frequently to poll backend to learn our capacity.
</span><span style=color:#00a000>+# CLI flag: -table-manager.poll-interval
</span><span style=color:#00a000>+[poll_interval: &lt;duration&gt; | default = 2m0s]
</span><span style=color:#00a000></span>
<span style=color:#a40000>-# DynamoDB periodic tables grace period (duration which table will be
</span><span style=color:#a40000>-# created/deleted before/after it&#39;s needed).
</span><span style=color:#a40000>-# CLI flag: -dynamodb.periodic-table.grace-period
</span><span style=color:#a40000></span><span style=color:#00a000>+# Periodic tables grace period (duration which table will be created/deleted
</span><span style=color:#00a000>+# before/after it&#39;s needed).
</span><span style=color:#00a000>+# CLI flag: -table-manager.periodic-table.grace-period
</span><span style=color:#00a000></span> [creation_grace_period: &lt;duration&gt; | default = 10m0s]

 index_tables_provisioning:
   # Enables on demand throughput provisioning for the storage provider (if
<span style=color:#a40000>-  # supported). Applies only to tables which are not autoscaled
</span><span style=color:#a40000>-  # CLI flag: -dynamodb.periodic-table.enable-ondemand-throughput-mode
</span><span style=color:#a40000>-  [provisioned_throughput_on_demand_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+  # supported). Applies only to tables which are not autoscaled. Supported by
</span><span style=color:#00a000>+  # DynamoDB
</span><span style=color:#00a000>+  # CLI flag: -table-manager.index-table.enable-ondemand-throughput-mode
</span><span style=color:#00a000>+  [enable_ondemand_throughput_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>

   # Enables on demand throughput provisioning for the storage provider (if
<span style=color:#a40000>-  # supported). Applies only to tables which are not autoscaled
</span><span style=color:#a40000>-  # CLI flag: -dynamodb.periodic-table.inactive-enable-ondemand-throughput-mode
</span><span style=color:#a40000>-  [inactive_throughput_on_demand_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+  # supported). Applies only to tables which are not autoscaled. Supported by
</span><span style=color:#00a000>+  # DynamoDB
</span><span style=color:#00a000>+  # CLI flag: -table-manager.index-table.inactive-enable-ondemand-throughput-mode
</span><span style=color:#00a000>+  [enable_inactive_throughput_on_demand_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>

 chunk_tables_provisioning:
   # Enables on demand throughput provisioning for the storage provider (if
<span style=color:#a40000>-  # supported). Applies only to tables which are not autoscaled
</span><span style=color:#a40000>-  # CLI flag: -dynamodb.chunk-table.enable-ondemand-throughput-mode
</span><span style=color:#a40000>-  [provisioned_throughput_on_demand_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000></span><span style=color:#00a000>+  # supported). Applies only to tables which are not autoscaled. Supported by
</span><span style=color:#00a000>+  # DynamoDB
</span><span style=color:#00a000>+  # CLI flag: -table-manager.chunk-table.enable-ondemand-throughput-mode
</span><span style=color:#00a000>+  [enable_ondemand_throughput_mode: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>
### storage_config

 aws:
<span style=color:#a40000>-  dynamodbconfig:
</span><span style=color:#a40000></span><span style=color:#00a000>+  dynamodb:
</span><span style=color:#00a000></span>     # DynamoDB endpoint URL with escaped Key and Secret encoded. If only region
     # is specified as a host, proper endpoint will be deduced. Use
     # inmemory:///&lt;table-name&gt; to use a mock in-memory implementation.
     # CLI flag: -dynamodb.url
<span style=color:#a40000>-    [dynamodb: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [dynamodb_url: &lt;url&gt; | default = ]
</span><span style=color:#00a000></span>
     # DynamoDB table management requests per second limit.
     # CLI flag: -dynamodb.api-limit
<span style=color:#a40000>-    [apilimit: &lt;float&gt; | default = 2]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [api_limit: &lt;float&gt; | default = 2]
</span><span style=color:#00a000></span>
     # DynamoDB rate cap to back off when throttled.
     # CLI flag: -dynamodb.throttle-limit
<span style=color:#a40000>-    [throttlelimit: &lt;float&gt; | default = 10]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [throttle_limit: &lt;float&gt; | default = 10]
</span><span style=color:#00a000></span><span style=color:#a40000>-
</span><span style=color:#a40000>-    # ApplicationAutoscaling endpoint URL with escaped Key and Secret encoded.
</span><span style=color:#a40000>-    # CLI flag: -applicationautoscaling.url
</span><span style=color:#a40000>-    [applicationautoscaling: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span>

       # Queue length above which we will scale up capacity
       # CLI flag: -metrics.target-queue-length
<span style=color:#a40000>-      [targetqueuelen: &lt;int&gt; | default = 100000]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [target_queue_length: &lt;int&gt; | default = 100000]
</span><span style=color:#00a000></span>
       # Scale up capacity by this multiple
       # CLI flag: -metrics.scale-up-factor
<span style=color:#a40000>-      [scaleupfactor: &lt;float&gt; | default = 1.3]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [scale_up_factor: &lt;float&gt; | default = 1.3]
</span><span style=color:#00a000></span>
       # Ignore throttling below this level (rate per second)
       # CLI flag: -metrics.ignore-throttle-below
<span style=color:#a40000>-      [minthrottling: &lt;float&gt; | default = 1]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [ignore_throttle_below: &lt;float&gt; | default = 1]
</span><span style=color:#00a000></span>
       # query to fetch ingester queue length
       # CLI flag: -metrics.queue-length-query
<span style=color:#a40000>-      [queuelengthquery: &lt;string&gt; | default = &#34;sum(avg_over_time(cortex_ingester_flush_queue_length{job=\&#34;cortex/ingester\&#34;}[2m]))&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [queue_length_query: &lt;string&gt; | default = &#34;sum(avg_over_time(cortex_ingester_flush_queue_length{job=\&#34;cortex/ingester\&#34;}[2m]))&#34;]
</span><span style=color:#00a000></span>
       # query to fetch throttle rates per table
       # CLI flag: -metrics.write-throttle-query
<span style=color:#a40000>-      [throttlequery: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_throttled_total{operation=\&#34;DynamoDB.BatchWriteItem\&#34;}[1m])) by (table) &gt; 0&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [write_throttle_query: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_throttled_total{operation=\&#34;DynamoDB.BatchWriteItem\&#34;}[1m])) by (table) &gt; 0&#34;]
</span><span style=color:#00a000></span>
       # query to fetch write capacity usage per table
       # CLI flag: -metrics.usage-query
<span style=color:#a40000>-      [usagequery: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_consumed_capacity_total{operation=\&#34;DynamoDB.BatchWriteItem\&#34;}[15m])) by (table) &gt; 0&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [write_usage_query: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_consumed_capacity_total{operation=\&#34;DynamoDB.BatchWriteItem\&#34;}[15m])) by (table) &gt; 0&#34;]
</span><span style=color:#00a000></span>
       # query to fetch read capacity usage per table
       # CLI flag: -metrics.read-usage-query
<span style=color:#a40000>-      [readusagequery: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_consumed_capacity_total{operation=\&#34;DynamoDB.QueryPages\&#34;}[1h])) by (table) &gt; 0&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [read_usage_query: &lt;string&gt; | default = &#34;sum(rate(cortex_dynamo_consumed_capacity_total{operation=\&#34;DynamoDB.QueryPages\&#34;}[1h])) by (table) &gt; 0&#34;]
</span><span style=color:#00a000></span>
       # query to fetch read errors per table
       # CLI flag: -metrics.read-error-query
<span style=color:#a40000>-      [readerrorquery: &lt;string&gt; | default = &#34;sum(increase(cortex_dynamo_failures_total{operation=\&#34;DynamoDB.QueryPages\&#34;,error=\&#34;ProvisionedThroughputExceededException\&#34;}[1m])) by (table) &gt; 0&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [read_error_query: &lt;string&gt; | default = &#34;sum(increase(cortex_dynamo_failures_total{operation=\&#34;DynamoDB.QueryPages\&#34;,error=\&#34;ProvisionedThroughputExceededException\&#34;}[1m])) by (table) &gt; 0&#34;]
</span><span style=color:#00a000></span>
     # Number of chunks to group together to parallelise fetches (zero to
     # disable)
<span style=color:#a40000>-    # CLI flag: -dynamodb.chunk.gang.size
</span><span style=color:#a40000>-    [chunkgangsize: &lt;int&gt; | default = 10]
</span><span style=color:#a40000></span><span style=color:#00a000>+    # CLI flag: -dynamodb.chunk-gang-size
</span><span style=color:#00a000>+    [chunk_gang_size: &lt;int&gt; | default = 10]
</span><span style=color:#00a000></span>
     # Max number of chunk-get operations to start in parallel
<span style=color:#a40000>-    # CLI flag: -dynamodb.chunk.get.max.parallelism
</span><span style=color:#a40000>-    [chunkgetmaxparallelism: &lt;int&gt; | default = 32]
</span><span style=color:#a40000></span><span style=color:#00a000>+    # CLI flag: -dynamodb.chunk.get-max-parallelism
</span><span style=color:#00a000>+    [chunk_get_max_parallelism: &lt;int&gt; | default = 32]
</span><span style=color:#00a000></span>
     backoff_config:
       # Minimum delay when backing off.
       # CLI flag: -bigtable.backoff-min-period
<span style=color:#a40000>-      [minbackoff: &lt;duration&gt; | default = 100ms]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [min_period: &lt;duration&gt; | default = 100ms]
</span><span style=color:#00a000></span>
       # Maximum delay when backing off.
       # CLI flag: -bigtable.backoff-max-period
<span style=color:#a40000>-      [maxbackoff: &lt;duration&gt; | default = 10s]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [max_period: &lt;duration&gt; | default = 10s]
</span><span style=color:#00a000></span>
       # Number of times to backoff and retry before failing.
       # CLI flag: -bigtable.backoff-retries
<span style=color:#a40000>-      [maxretries: &lt;int&gt; | default = 10]
</span><span style=color:#a40000></span><span style=color:#00a000>+      [max_retries: &lt;int&gt; | default = 10]
</span><span style=color:#00a000></span>
   # If enabled, once a tables info is fetched, it is cached.
   # CLI flag: -bigtable.table-cache.enabled
<span style=color:#a40000>-  [tablecacheenabled: &lt;boolean&gt; | default = true]
</span><span style=color:#a40000></span><span style=color:#00a000>+  [table_cache_enabled: &lt;boolean&gt; | default = true]
</span><span style=color:#00a000></span>
   # Duration to cache tables before checking again.
   # CLI flag: -bigtable.table-cache.expiration
<span style=color:#a40000>-  [tablecacheexpiration: &lt;duration&gt; | default = 30m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+  [table_cache_expiration: &lt;duration&gt; | default = 30m0s]
</span><span style=color:#00a000></span>
 # Cache validity for active index entries. Should be no higher than
 # -ingester.max-chunk-idle.
 # CLI flag: -store.index-cache-validity
<span style=color:#a40000>-[indexcachevalidity: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[index_cache_validity: &lt;duration&gt; | default = 5m0s]
</span><span style=color:#00a000></span>
### ingester_client_config

 grpc_client_config:
   backoff_config:
     # Minimum delay when backing off.
     # CLI flag: -ingester.client.backoff-min-period
<span style=color:#a40000>-    [minbackoff: &lt;duration&gt; | default = 100ms]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [min_period: &lt;duration&gt; | default = 100ms]
</span><span style=color:#00a000></span>
     # Maximum delay when backing off.
     # CLI flag: -ingester.client.backoff-max-period
<span style=color:#a40000>-    [maxbackoff: &lt;duration&gt; | default = 10s]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [max_period: &lt;duration&gt; | default = 10s]
</span><span style=color:#00a000></span>
     # Number of times to backoff and retry before failing.
     # CLI flag: -ingester.client.backoff-retries
<span style=color:#a40000>-    [maxretries: &lt;int&gt; | default = 10]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [max_retries: &lt;int&gt; | default = 10]
</span><span style=color:#00a000></span>
### frontend_worker_config

<span style=color:#a40000>-# Address of query frontend service.
</span><span style=color:#a40000></span><span style=color:#00a000>+# Address of query frontend service, in host:port format.
</span><span style=color:#00a000></span> # CLI flag: -querier.frontend-address
<span style=color:#a40000>-[address: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[frontend_address: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>
 # How often to query DNS.
 # CLI flag: -querier.dns-lookup-period
<span style=color:#a40000>-[dnslookupduration: &lt;duration&gt; | default = 10s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[dns_lookup_duration: &lt;duration&gt; | default = 10s]
</span><span style=color:#00a000></span>
 grpc_client_config:
   backoff_config:
     # Minimum delay when backing off.
     # CLI flag: -querier.frontend-client.backoff-min-period
<span style=color:#a40000>-    [minbackoff: &lt;duration&gt; | default = 100ms]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [min_period: &lt;duration&gt; | default = 100ms]
</span><span style=color:#00a000></span>
     # Maximum delay when backing off.
     # CLI flag: -querier.frontend-client.backoff-max-period
<span style=color:#a40000>-    [maxbackoff: &lt;duration&gt; | default = 10s]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [max_period: &lt;duration&gt; | default = 10s]
</span><span style=color:#00a000></span>
     # Number of times to backoff and retry before failing.
     # CLI flag: -querier.frontend-client.backoff-retries
<span style=color:#a40000>-    [maxretries: &lt;int&gt; | default = 10]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [max_retries: &lt;int&gt; | default = 10]
</span><span style=color:#00a000></span>
### consul_config

 # ACL Token used to interact with Consul.
<span style=color:#a40000>-# CLI flag: -&lt;prefix&gt;.consul.acltoken
</span><span style=color:#a40000>-[acltoken: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span><span style=color:#00a000>+# CLI flag: -&lt;prefix&gt;.consul.acl-token
</span><span style=color:#00a000>+[acl_token: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>
 # HTTP timeout when talking to Consul
 # CLI flag: -&lt;prefix&gt;.consul.client-timeout
<span style=color:#a40000>-[httpclienttimeout: &lt;duration&gt; | default = 20s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[http_client_timeout: &lt;duration&gt; | default = 20s]
</span><span style=color:#00a000></span>
 # Enable consistent reads to Consul.
 # CLI flag: -&lt;prefix&gt;.consul.consistent-reads
<span style=color:#a40000>-[consistentreads: &lt;boolean&gt; | default = true]
</span><span style=color:#a40000></span><span style=color:#00a000>+[consistent_reads: &lt;boolean&gt; | default = false]
</span><span style=color:#00a000></span>
 # Rate limit when watching key or prefix in Consul, in requests per second. 0
 # disables the rate limit.
 # CLI flag: -&lt;prefix&gt;.consul.watch-rate-limit
<span style=color:#a40000>-[watchkeyratelimit: &lt;float&gt; | default = 0]
</span><span style=color:#a40000></span><span style=color:#00a000>+[watch_rate_limit: &lt;float&gt; | default = 1]
</span><span style=color:#00a000></span>
 # Burst size used in rate limit. Values less than 1 are treated as 1.
 # CLI flag: -&lt;prefix&gt;.consul.watch-burst-size
<span style=color:#a40000>-[watchkeyburstsize: &lt;int&gt; | default = 1]
</span><span style=color:#a40000></span><span style=color:#00a000>+[watch_burst_size: &lt;int&gt; | default = 1]
</span><span style=color:#00a000></span>

### configstore_config
 # URL of configs API server.
 # CLI flag: -&lt;prefix&gt;.configs.url
<span style=color:#a40000>-[configsapiurl: &lt;url&gt; | default = ]
</span><span style=color:#a40000></span><span style=color:#00a000>+[configs_api_url: &lt;url&gt; | default = ]
</span><span style=color:#00a000></span>
 # Timeout for requests to Weave Cloud configs service.
 # CLI flag: -&lt;prefix&gt;.configs.client-timeout
<span style=color:#a40000>-[clienttimeout: &lt;duration&gt; | default = 5s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[client_timeout: &lt;duration&gt; | default = 5s]
</span></code></pre></div><h2 id=070--2020-03-16>0.7.0 / 2020-03-16</h2><p>Cortex <code>0.7.0</code> is a major step forward the upcoming <code>1.0</code> release. In this release, we&rsquo;ve got 164 contributions from 26 authors. Thanks to all contributors! ❤️</p><p>Please be aware that Cortex <code>0.7.0</code> introduces some <strong>breaking changes</strong>. You&rsquo;re encouraged to read all the <code>[CHANGE]</code> entries below before upgrading your Cortex cluster. In particular:</p><ul><li>Cleaned up some configuration options in preparation for the Cortex <code>1.0.0</code> release (see also the <a href=#annotated-config-file-breaking-changes>annotated config file breaking changes</a> below):<ul><li>Removed CLI flags support to configure the schema (see <a href=https://cortexmetrics.io/docs/configuration/schema-configuration/#migrating-from-flags-to-schema-file>how to migrate from flags to schema file</a>)</li><li>Renamed CLI flag <code>-config-yaml</code> to <code>-schema-config-file</code></li><li>Removed CLI flag <code>-store.min-chunk-age</code> in favor of <code>-querier.query-store-after</code>. The corresponding YAML config option <code>ingestermaxquerylookback</code> has been renamed to <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#querier-config><code>query_ingesters_within</code></a></li><li>Deprecated CLI flag <code>-frontend.cache-split-interval</code> in favor of <code>-querier.split-queries-by-interval</code></li><li>Renamed the YAML config option <code>defaul_validity</code> to <code>default_validity</code></li><li>Removed the YAML config option <code>config_store</code> (in the <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#alertmanager-config><code>alertmanager YAML config</code></a>) in favor of <code>store</code></li><li>Removed the YAML config root block <code>configdb</code> in favor of <a href=https://cortexmetrics.io/docs/configuration/configuration-file/#configs-config><code>configs</code></a>. This change is also reflected in the following CLI flags renaming:<ul><li><code>-database.*</code> -> <code>-configs.database.*</code></li><li><code>-database.migrations</code> -> <code>-configs.database.migrations-dir</code></li></ul></li><li>Removed the fluentd-based billing infrastructure including the CLI flags:<ul><li><code>-distributor.enable-billing</code></li><li><code>-billing.max-buffered-events</code></li><li><code>-billing.retry-delay</code></li><li><code>-billing.ingester</code></li></ul></li></ul></li><li>Removed support for using denormalised tokens in the ring. Before upgrading, make sure your Cortex cluster is already running <code>v0.6.0</code> or an earlier version with <code>-ingester.normalise-tokens=true</code></li></ul><h3 id=full-changelog>Full changelog</h3><ul><li>[CHANGE] Removed support for flags to configure schema. Further, the flag for specifying the config file (<code>-config-yaml</code>) has been deprecated. Please use <code>-schema-config-file</code>. See the <a href=https://cortexmetrics.io/docs/configuration/schema-configuration/>Schema Configuration documentation</a> for more details on how to configure the schema using the YAML file. <a href=https://github.com/cortexproject/cortex/pull/2221>#2221</a></li><li>[CHANGE] In the config file, the root level <code>config_store</code> config option has been moved to <code>alertmanager</code> > <code>store</code> > <code>configdb</code>. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[CHANGE] Removed unnecessary <code>frontend.cache-split-interval</code> in favor of <code>querier.split-queries-by-interval</code> both to reduce configuration complexity and guarantee alignment of these two configs. Starting from now, <code>-querier.cache-results</code> may only be enabled in conjunction with <code>-querier.split-queries-by-interval</code> (previously the cache interval default was <code>24h</code> so if you want to preserve the same behaviour you should set <code>-querier.split-queries-by-interval=24h</code>). <a href=https://github.com/cortexproject/cortex/pull/2040>#2040</a></li><li>[CHANGE] Renamed Configs configuration options. <a href=https://github.com/cortexproject/cortex/pull/2187>#2187</a><ul><li>configuration options<ul><li><code>-database.*</code> -> <code>-configs.database.*</code></li><li><code>-database.migrations</code> -> <code>-configs.database.migrations-dir</code></li></ul></li><li>config file<ul><li><code>configdb.uri:</code> -> <code>configs.database.uri:</code></li><li><code>configdb.migrationsdir:</code> -> <code>configs.database.migrations_dir:</code></li><li><code>configdb.passwordfile:</code> -> <code>configs.database.password_file:</code></li></ul></li></ul></li><li>[CHANGE] Moved <code>-store.min-chunk-age</code> to the Querier config as <code>-querier.query-store-after</code>, allowing the store to be skipped during query time if the metrics wouldn&rsquo;t be found. The YAML config option <code>ingestermaxquerylookback</code> has been renamed to <code>query_ingesters_within</code> to match its CLI flag. <a href=https://github.com/cortexproject/cortex/pull/1893>#1893</a></li><li>[CHANGE] Renamed the cache configuration setting <code>defaul_validity</code> to <code>default_validity</code>. <a href=https://github.com/cortexproject/cortex/pull/2140>#2140</a></li><li>[CHANGE] Remove fluentd-based billing infrastructure and flags such as <code>-distributor.enable-billing</code>. <a href=https://github.com/cortexproject/cortex/pull/1491>#1491</a></li><li>[CHANGE] Removed remaining support for using denormalised tokens in the ring. If you&rsquo;re still running ingesters with denormalised tokens (Cortex 0.4 or earlier, with <code>-ingester.normalise-tokens=false</code>), such ingesters will now be completely invisible to distributors and need to be either switched to Cortex 0.6.0 or later, or be configured to use normalised tokens. <a href=https://github.com/cortexproject/cortex/pull/2034>#2034</a></li><li>[CHANGE] The frontend http server will now send 502 in case of deadline exceeded and 499 if the user requested cancellation. <a href=https://github.com/cortexproject/cortex/pull/2156>#2156</a></li><li>[CHANGE] We now enforce queries to be up to <code>-querier.max-query-into-future</code> into the future (defaults to 10m). <a href=https://github.com/cortexproject/cortex/pull/1929>#1929</a><ul><li><code>-store.min-chunk-age</code> has been removed</li><li><code>-querier.query-store-after</code> has been added in it&rsquo;s place.</li></ul></li><li>[CHANGE] Removed unused <code>/validate_expr endpoint</code>. <a href=https://github.com/cortexproject/cortex/pull/2152>#2152</a></li><li>[CHANGE] Updated Prometheus dependency to v2.16.0. This Prometheus version uses Active Query Tracker to limit concurrent queries. In order to keep <code>-querier.max-concurrent</code> working, Active Query Tracker is enabled by default, and is configured to store its data to <code>active-query-tracker</code> directory (relative to current directory when Cortex started). This can be changed by using <code>-querier.active-query-tracker-dir</code> option. Purpose of Active Query Tracker is to log queries that were running when Cortex crashes. This logging happens on next Cortex start. <a href=https://github.com/cortexproject/cortex/pull/2088>#2088</a></li><li>[CHANGE] Default to BigChunk encoding; may result in slightly higher disk usage if many timeseries have a constant value, but should generally result in fewer, bigger chunks. <a href=https://github.com/cortexproject/cortex/pull/2207>#2207</a></li><li>[CHANGE] WAL replays are now done while the rest of Cortex is starting, and more specifically, when HTTP server is running. This makes it possible to scrape metrics during WAL replays. Applies to both chunks and experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2222>#2222</a></li><li>[CHANGE] Cortex now has <code>/ready</code> probe for all services, not just ingester and querier as before. In single-binary mode, /ready reports 204 only if all components are running properly. <a href=https://github.com/cortexproject/cortex/pull/2166>#2166</a></li><li>[CHANGE] If you are vendoring Cortex and use its components in your project, be aware that many Cortex components no longer start automatically when they are created. You may want to review PR and attached document. <a href=https://github.com/cortexproject/cortex/pull/2166>#2166</a></li><li>[CHANGE] Experimental TSDB: the querier in-memory index cache used by the experimental blocks storage shifted from per-tenant to per-querier. The <code>-experimental.tsdb.bucket-store.index-cache-size-bytes</code> now configures the per-querier index cache max size instead of a per-tenant cache and its default has been increased to 1GB. <a href=https://github.com/cortexproject/cortex/pull/2189>#2189</a></li><li>[CHANGE] Experimental TSDB: TSDB head compaction interval and concurrency is now configurable (defaults to 1 min interval and 5 concurrent head compactions). New options: <code>-experimental.tsdb.head-compaction-interval</code> and <code>-experimental.tsdb.head-compaction-concurrency</code>. <a href=https://github.com/cortexproject/cortex/pull/2172>#2172</a></li><li>[CHANGE] Experimental TSDB: switched the blocks storage index header to the binary format. This change is expected to have no visible impact, except lower startup times and memory usage in the queriers. It&rsquo;s possible to switch back to the old JSON format via the flag <code>-experimental.tsdb.bucket-store.binary-index-header-enabled=false</code>. <a href=https://github.com/cortexproject/cortex/pull/2223>#2223</a></li><li>[CHANGE] Experimental Memberlist KV store can now be used in single-binary Cortex. Attempts to use it previously would fail with panic. This change also breaks existing binary protocol used to exchange gossip messages, so this version will not be able to understand gossiped Ring when used in combination with the previous version of Cortex. Easiest way to upgrade is to shutdown old Cortex installation, and restart it with new version. Incremental rollout works too, but with reduced functionality until all components run the same version. <a href=https://github.com/cortexproject/cortex/pull/2016>#2016</a></li><li>[FEATURE] Added a read-only local alertmanager config store using files named corresponding to their tenant id. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[FEATURE] Added flag <code>-experimental.ruler.enable-api</code> to enable the ruler api which implements the Prometheus API <code>/api/v1/rules</code> and <code>/api/v1/alerts</code> endpoints under the configured <code>-http.prefix</code>. <a href=https://github.com/cortexproject/cortex/pull/1999>#1999</a></li><li>[FEATURE] Added sharding support to compactor when using the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2113>#2113</a></li><li>[FEATURE] Added ability to override YAML config file settings using environment variables. <a href=https://github.com/cortexproject/cortex/pull/2147>#2147</a><ul><li><code>-config.expand-env</code></li></ul></li><li>[FEATURE] Added flags to disable Alertmanager notifications methods. <a href=https://github.com/cortexproject/cortex/pull/2187>#2187</a><ul><li><code>-configs.notifications.disable-email</code></li><li><code>-configs.notifications.disable-webhook</code></li></ul></li><li>[FEATURE] Add /config HTTP endpoint which exposes the current Cortex configuration as YAML. <a href=https://github.com/cortexproject/cortex/pull/2165>#2165</a></li><li>[FEATURE] Allow Prometheus remote write directly to ingesters. <a href=https://github.com/cortexproject/cortex/pull/1491>#1491</a></li><li>[FEATURE] Introduced new standalone service <code>query-tee</code> that can be used for testing purposes to send the same Prometheus query to multiple backends (ie. two Cortex clusters ingesting the same metrics) and compare the performances. <a href=https://github.com/cortexproject/cortex/pull/2203>#2203</a></li><li>[FEATURE] Fan out parallelizable queries to backend queriers concurrently. <a href=https://github.com/cortexproject/cortex/pull/1878>#1878</a><ul><li><code>querier.parallelise-shardable-queries</code> (bool)</li><li>Requires a shard-compatible schema (v10+)</li><li>This causes the number of traces to increase accordingly.</li><li>The query-frontend now requires a schema config to determine how/when to shard queries, either from a file or from flags (i.e. by the <code>config-yaml</code> CLI flag). This is the same schema config the queriers consume. The schema is only required to use this option.</li><li>It&rsquo;s also advised to increase downstream concurrency controls as well:<ul><li><code>querier.max-outstanding-requests-per-tenant</code></li><li><code>querier.max-query-parallelism</code></li><li><code>querier.max-concurrent</code></li><li><code>server.grpc-max-concurrent-streams</code> (for both query-frontends and queriers)</li></ul></li></ul></li><li>[FEATURE] Added user sub rings to distribute users to a subset of ingesters. <a href=https://github.com/cortexproject/cortex/pull/1947>#1947</a><ul><li><code>-experimental.distributor.user-subring-size</code></li></ul></li><li>[FEATURE] Add flag <code>-experimental.tsdb.stripe-size</code> to expose TSDB stripe size option. <a href=https://github.com/cortexproject/cortex/pull/2185>#2185</a></li><li>[FEATURE] Experimental Delete Series: Added support for Deleting Series with Prometheus style API. Needs to be enabled first by setting <code>-purger.enable</code> to <code>true</code>. Deletion only supported when using <code>boltdb</code> and <code>filesystem</code> as index and object store respectively. Support for other stores to follow in separate PRs <a href=https://github.com/cortexproject/cortex/pull/2103>#2103</a></li><li>[ENHANCEMENT] Alertmanager: Expose Per-tenant alertmanager metrics <a href=https://github.com/cortexproject/cortex/pull/2124>#2124</a></li><li>[ENHANCEMENT] Add <code>status</code> label to <code>cortex_alertmanager_configs</code> metric to gauge the number of valid and invalid configs. <a href=https://github.com/cortexproject/cortex/pull/2125>#2125</a></li><li>[ENHANCEMENT] Cassandra Authentication: added the <code>custom_authenticators</code> config option that allows users to authenticate with cassandra clusters using password authenticators that are not approved by default in <a href=https://github.com/gocql/gocql/blob/81b8263d9fe526782a588ef94d3fa5c6148e5d67/conn.go#L27>gocql</a> <a href=https://github.com/cortexproject/cortex/pull/2093>#2093</a></li><li>[ENHANCEMENT] Cassandra Storage: added <code>max_retries</code>, <code>retry_min_backoff</code> and <code>retry_max_backoff</code> configuration options to enable retrying recoverable errors. <a href=https://github.com/cortexproject/cortex/pull/2054>#2054</a></li><li>[ENHANCEMENT] Allow to configure HTTP and gRPC server listen address, maximum number of simultaneous connections and connection keepalive settings.<ul><li><code>-server.http-listen-address</code></li><li><code>-server.http-conn-limit</code></li><li><code>-server.grpc-listen-address</code></li><li><code>-server.grpc-conn-limit</code></li><li><code>-server.grpc.keepalive.max-connection-idle</code></li><li><code>-server.grpc.keepalive.max-connection-age</code></li><li><code>-server.grpc.keepalive.max-connection-age-grace</code></li><li><code>-server.grpc.keepalive.time</code></li><li><code>-server.grpc.keepalive.timeout</code></li></ul></li><li>[ENHANCEMENT] PostgreSQL: Bump up <code>github.com/lib/pq</code> from <code>v1.0.0</code> to <code>v1.3.0</code> to support PostgreSQL SCRAM-SHA-256 authentication. <a href=https://github.com/cortexproject/cortex/pull/2097>#2097</a></li><li>[ENHANCEMENT] Cassandra Storage: User no longer need <code>CREATE</code> privilege on <code>&lt;all keyspaces></code> if given keyspace exists. <a href=https://github.com/cortexproject/cortex/pull/2032>#2032</a></li><li>[ENHANCEMENT] Cassandra Storage: added <code>password_file</code> configuration options to enable reading Cassandra password from file. <a href=https://github.com/cortexproject/cortex/pull/2096>#2096</a></li><li>[ENHANCEMENT] Configs API: Allow GET/POST configs in YAML format. <a href=https://github.com/cortexproject/cortex/pull/2181>#2181</a></li><li>[ENHANCEMENT] Background cache writes are batched to improve parallelism and observability. <a href=https://github.com/cortexproject/cortex/pull/2135>#2135</a></li><li>[ENHANCEMENT] Add automatic repair for checkpoint and WAL. <a href=https://github.com/cortexproject/cortex/pull/2105>#2105</a></li><li>[ENHANCEMENT] Support <code>lastEvaluation</code> and <code>evaluationTime</code> in <code>/api/v1/rules</code> endpoints and make order of groups stable. <a href=https://github.com/cortexproject/cortex/pull/2196>#2196</a></li><li>[ENHANCEMENT] Skip expired requests in query-frontend scheduling. <a href=https://github.com/cortexproject/cortex/pull/2082>#2082</a></li><li>[ENHANCEMENT] Add ability to configure gRPC keepalive settings. <a href=https://github.com/cortexproject/cortex/pull/2066>#2066</a></li><li>[ENHANCEMENT] Experimental TSDB: Export TSDB Syncer metrics from Compactor component, they are prefixed with <code>cortex_compactor_</code>. <a href=https://github.com/cortexproject/cortex/pull/2023>#2023</a></li><li>[ENHANCEMENT] Experimental TSDB: Added dedicated flag <code>-experimental.tsdb.bucket-store.tenant-sync-concurrency</code> to configure the maximum number of concurrent tenants for which blocks are synched. <a href=https://github.com/cortexproject/cortex/pull/2026>#2026</a></li><li>[ENHANCEMENT] Experimental TSDB: Expose metrics for objstore operations (prefixed with <code>cortex_&lt;component>_thanos_objstore_</code>, component being one of <code>ingester</code>, <code>querier</code> and <code>compactor</code>). <a href=https://github.com/cortexproject/cortex/pull/2027>#2027</a></li><li>[ENHANCEMENT] Experimental TSDB: Added support for Azure Storage to be used for block storage, in addition to S3 and GCS. <a href=https://github.com/cortexproject/cortex/pull/2083>#2083</a></li><li>[ENHANCEMENT] Experimental TSDB: Reduced memory allocations in the ingesters when using the experimental blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2057>#2057</a></li><li>[ENHANCEMENT] Experimental Memberlist KV: expose <code>-memberlist.gossip-to-dead-nodes-time</code> and <code>-memberlist.dead-node-reclaim-time</code> options to control how memberlist library handles dead nodes and name reuse. <a href=https://github.com/cortexproject/cortex/pull/2131>#2131</a></li><li>[BUGFIX] Alertmanager: fixed panic upon applying a new config, caused by duplicate metrics registration in the <code>NewPipelineBuilder</code> function. <a href=https://github.com/cortexproject/cortex/pull/211>#211</a></li><li>[BUGFIX] Azure Blob ChunkStore: Fixed issue causing <code>invalid chunk checksum</code> errors. <a href=https://github.com/cortexproject/cortex/pull/2074>#2074</a></li><li>[BUGFIX] The gauge <code>cortex_overrides_last_reload_successful</code> is now only exported by components that use a <code>RuntimeConfigManager</code>. Previously, for components that do not initialize a <code>RuntimeConfigManager</code> (such as the compactor) the gauge was initialized with 0 (indicating error state) and then never updated, resulting in a false-negative permanent error state. <a href=https://github.com/cortexproject/cortex/pull/2092>#2092</a></li><li>[BUGFIX] Fixed WAL metric names, added the <code>cortex_</code> prefix.</li><li>[BUGFIX] Restored histogram <code>cortex_configs_request_duration_seconds</code> <a href=https://github.com/cortexproject/cortex/pull/2138>#2138</a></li><li>[BUGFIX] Fix wrong syntax for <code>url</code> in config-file-reference. <a href=https://github.com/cortexproject/cortex/pull/2148>#2148</a></li><li>[BUGFIX] Fixed some 5xx status code returned by the query-frontend when they should actually be 4xx. <a href=https://github.com/cortexproject/cortex/pull/2122>#2122</a></li><li>[BUGFIX] Fixed leaked goroutines in the querier. <a href=https://github.com/cortexproject/cortex/pull/2070>#2070</a></li><li>[BUGFIX] Experimental TSDB: fixed <code>/all_user_stats</code> and <code>/api/prom/user_stats</code> endpoints when using the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2042>#2042</a></li><li>[BUGFIX] Experimental TSDB: fixed ruler to correctly work with the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/2101>#2101</a></li></ul><h3 id=changes-to-denormalised-tokens-in-the-ring>Changes to denormalised tokens in the ring</h3><p>Cortex 0.4.0 is the last version that can <em>write</em> denormalised tokens. Cortex 0.5.0 and above always write normalised tokens.</p><p>Cortex 0.6.0 is the last version that can <em>read</em> denormalised tokens. Starting with Cortex 0.7.0 only normalised tokens are supported, and ingesters writing denormalised tokens to the ring (running Cortex 0.4.0 or earlier with <code>-ingester.normalise-tokens=false</code>) are ignored by distributors. Such ingesters should either switch to using normalised tokens, or be upgraded to Cortex 0.5.0 or later.</p><h3 id=known-issues-1>Known issues</h3><ul><li>The gRPC streaming for ingesters doesn&rsquo;t work when using the experimental TSDB blocks storage. Please do not enable <code>-querier.ingester-streaming</code> if you&rsquo;re using the TSDB blocks storage. If you want to enable it, you can build Cortex from <code>master</code> given the issue has been fixed after Cortex <code>0.7</code> branch has been cut and the fix wasn&rsquo;t included in the <code>0.7</code> because related to an experimental feature.</li></ul><h3 id=annotated-config-file-breaking-changes>Annotated config file breaking changes</h3><p>In this section you can find a config file diff showing the breaking changes introduced in Cortex <code>0.7</code>. You can also find the <a href=https://cortexmetrics.io/docs/configuration/configuration-file/>full configuration file reference doc</a> in the website.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff>### Root level config

# &#34;configdb&#34; has been moved to &#34;alertmanager &gt; store &gt; configdb&#34;.
<span style=color:#a40000>-[configdb: &lt;configdb_config&gt;]
</span><span style=color:#a40000></span>
# &#34;config_store&#34; has been renamed to &#34;configs&#34;.
<span style=color:#a40000>-[config_store: &lt;configstore_config&gt;]
</span><span style=color:#a40000></span><span style=color:#00a000>+[configs: &lt;configs_config&gt;]
</span><span style=color:#00a000></span>

### `distributor_config`

# The support to hook an external billing system has been removed.
<span style=color:#a40000>-[enable_billing: &lt;boolean&gt; | default = false]
</span><span style=color:#a40000>-billing:
</span><span style=color:#a40000>-  [maxbufferedevents: &lt;int&gt; | default = 1024]
</span><span style=color:#a40000>-  [retrydelay: &lt;duration&gt; | default = 500ms]
</span><span style=color:#a40000>-  [ingesterhostport: &lt;string&gt; | default = &#34;localhost:24225&#34;]
</span><span style=color:#a40000></span>

### `querier_config`

# &#34;ingestermaxquerylookback&#34; has been renamed to &#34;query_ingesters_within&#34;.
<span style=color:#a40000>-[ingestermaxquerylookback: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+[query_ingesters_within: &lt;duration&gt; | default = 0s]
</span><span style=color:#00a000></span>

### `queryrange_config`

results_cache:
 cache:
    # &#34;defaul_validity&#34; has been renamed to &#34;default_validity&#34;.
<span style=color:#a40000>-    [defaul_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+    [default_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#00a000></span>
  # &#34;cache_split_interval&#34; has been deprecated in favor of &#34;split_queries_by_interval&#34;.
<span style=color:#a40000>-  [cache_split_interval: &lt;duration&gt; | default = 24h0m0s]
</span><span style=color:#a40000></span>

### `alertmanager_config`

# The &#34;store&#34; config block has been added. This includes &#34;configdb&#34; which previously
# was the &#34;configdb&#34; root level config block.
<span style=color:#00a000>+store:
</span><span style=color:#00a000>+  [type: &lt;string&gt; | default = &#34;configdb&#34;]
</span><span style=color:#00a000>+  [configdb: &lt;configstore_config&gt;]
</span><span style=color:#00a000>+  local:
</span><span style=color:#00a000>+    [path: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000></span>

### `storage_config`

<span style=color:navy;font-weight:700>index_queries_cache_config:
</span><span style=color:navy;font-weight:700></span>  # &#34;defaul_validity&#34; has been renamed to &#34;default_validity&#34;.
<span style=color:#a40000>-  [defaul_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+  [default_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#00a000></span>

### `chunk_store_config`

chunk_cache_config:
  # &#34;defaul_validity&#34; has been renamed to &#34;default_validity&#34;.
<span style=color:#a40000>-  [defaul_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+  [default_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#00a000></span>
write_dedupe_cache_config:
  # &#34;defaul_validity&#34; has been renamed to &#34;default_validity&#34;.
<span style=color:#a40000>-  [defaul_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span><span style=color:#00a000>+  [default_validity: &lt;duration&gt; | default = 0s]
</span><span style=color:#00a000></span>
# &#34;min_chunk_age&#34; has been removed in favor of &#34;querier &gt; query_store_after&#34;.
<span style=color:#a40000>-[min_chunk_age: &lt;duration&gt; | default = 0s]
</span><span style=color:#a40000></span>

### `configs_config`

<span style=color:#a40000>-# &#34;uri&#34; has been moved to &#34;database &gt; uri&#34;.
</span><span style=color:#a40000>-[uri: &lt;string&gt; | default = &#34;postgres://postgres@configs-db.weave.local/configs?sslmode=disable&#34;]
</span><span style=color:#a40000></span>
<span style=color:#a40000>-# &#34;migrationsdir&#34; has been moved to &#34;database &gt; migrations_dir&#34;.
</span><span style=color:#a40000>-[migrationsdir: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span>
<span style=color:#a40000>-# &#34;passwordfile&#34; has been moved to &#34;database &gt; password_file&#34;.
</span><span style=color:#a40000>-[passwordfile: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#a40000></span>
<span style=color:#00a000>+database:
</span><span style=color:#00a000>+  [uri: &lt;string&gt; | default = &#34;postgres://postgres@configs-db.weave.local/configs?sslmode=disable&#34;]
</span><span style=color:#00a000>+  [migrations_dir: &lt;string&gt; | default = &#34;&#34;]
</span><span style=color:#00a000>+  [password_file: &lt;string&gt; | default = &#34;&#34;]
</span></code></pre></div><h2 id=061--2020-02-05>0.6.1 / 2020-02-05</h2><ul><li>[BUGFIX] Fixed parsing of the WAL configuration when specified in the YAML config file. <a href=https://github.com/cortexproject/cortex/pull/2071>#2071</a></li></ul><h2 id=060--2020-01-28>0.6.0 / 2020-01-28</h2><p>Note that the ruler flags need to be changed in this upgrade. You&rsquo;re moving from a single node ruler to something that might need to be sharded.
Further, if you&rsquo;re using the configs service, we&rsquo;ve upgraded the migration library and this requires some manual intervention. See full instructions below to upgrade your PostgreSQL.</p><ul><li>[CHANGE] The frontend component now does not cache results if it finds a <code>Cache-Control</code> header and if one of its values is <code>no-store</code>. <a href=https://github.com/cortexproject/cortex/pull/1974>#1974</a></li><li>[CHANGE] Flags changed with transition to upstream Prometheus rules manager:<ul><li><code>-ruler.client-timeout</code> is now <code>ruler.configs.client-timeout</code> in order to match <code>ruler.configs.url</code>.</li><li><code>-ruler.group-timeout</code>has been removed.</li><li><code>-ruler.num-workers</code> has been removed.</li><li><code>-ruler.rule-path</code> has been added to specify where the prometheus rule manager will sync rule files.</li><li><code>-ruler.storage.type</code> has beem added to specify the rule store backend type, currently only the configdb.</li><li><code>-ruler.poll-interval</code> has been added to specify the interval in which to poll new rule groups.</li><li><code>-ruler.evaluation-interval</code> default value has changed from <code>15s</code> to <code>1m</code> to match the default evaluation interval in Prometheus.</li><li>Ruler sharding requires a ring which can be configured via the ring flags prefixed by <code>ruler.ring.</code>. <a href=https://github.com/cortexproject/cortex/pull/1987>#1987</a></li></ul></li><li>[CHANGE] Use relative links from /ring page to make it work when used behind reverse proxy. <a href=https://github.com/cortexproject/cortex/pull/1896>#1896</a></li><li>[CHANGE] Deprecated <code>-distributor.limiter-reload-period</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1766>#1766</a></li><li>[CHANGE] Ingesters now write only normalised tokens to the ring, although they can still read denormalised tokens used by other ingesters. <code>-ingester.normalise-tokens</code> is now deprecated, and ignored. If you want to switch back to using denormalised tokens, you need to downgrade to Cortex 0.4.0. Previous versions don&rsquo;t handle claiming tokens from normalised ingesters correctly. <a href=https://github.com/cortexproject/cortex/pull/1809>#1809</a></li><li>[CHANGE] Overrides mechanism has been renamed to &ldquo;runtime config&rdquo;, and is now separate from limits. Runtime config is simply a file that is reloaded by Cortex every couple of seconds. Limits and now also multi KV use this mechanism.<br>New arguments were introduced: <code>-runtime-config.file</code> (defaults to empty) and <code>-runtime-config.reload-period</code> (defaults to 10 seconds), which replace previously used <code>-limits.per-user-override-config</code> and <code>-limits.per-user-override-period</code> options. Old options are still used if <code>-runtime-config.file</code> is not specified. This change is also reflected in YAML configuration, where old <code>limits.per_tenant_override_config</code> and <code>limits.per_tenant_override_period</code> fields are replaced with <code>runtime_config.file</code> and <code>runtime_config.period</code> respectively. <a href=https://github.com/cortexproject/cortex/pull/1749>#1749</a></li><li>[CHANGE] Cortex now rejects data with duplicate labels. Previously, such data was accepted, with duplicate labels removed with only one value left. <a href=https://github.com/cortexproject/cortex/pull/1964>#1964</a></li><li>[CHANGE] Changed the default value for <code>-distributor.ha-tracker.prefix</code> from <code>collectors/</code> to <code>ha-tracker/</code> in order to not clash with other keys (ie. ring) stored in the same key-value store. <a href=https://github.com/cortexproject/cortex/pull/1940>#1940</a></li><li>[FEATURE] Experimental: Write-Ahead-Log added in ingesters for more data reliability against ingester crashes. <a href=https://github.com/cortexproject/cortex/pull/1103>#1103</a><ul><li><code>--ingester.wal-enabled</code>: Setting this to <code>true</code> enables writing to WAL during ingestion.</li><li><code>--ingester.wal-dir</code>: Directory where the WAL data should be stored and/or recovered from.</li><li><code>--ingester.checkpoint-enabled</code>: Set this to <code>true</code> to enable checkpointing of in-memory chunks to disk.</li><li><code>--ingester.checkpoint-duration</code>: This is the interval at which checkpoints should be created.</li><li><code>--ingester.recover-from-wal</code>: Set this to <code>true</code> to recover data from an existing WAL.</li><li>For more information, please checkout the <a href=https://cortexmetrics.io/docs/guides/ingesters-with-wal/>&ldquo;Ingesters with WAL&rdquo; guide</a>.</li></ul></li><li>[FEATURE] The distributor can now drop labels from samples (similar to the removal of the replica label for HA ingestion) per user via the <code>distributor.drop-label</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1726>#1726</a></li><li>[FEATURE] Added flag <code>debug.mutex-profile-fraction</code> to enable mutex profiling <a href=https://github.com/cortexproject/cortex/pull/1969>#1969</a></li><li>[FEATURE] Added <code>global</code> ingestion rate limiter strategy. Deprecated <code>-distributor.limiter-reload-period</code> flag. <a href=https://github.com/cortexproject/cortex/pull/1766>#1766</a></li><li>[FEATURE] Added support for Microsoft Azure blob storage to be used for storing chunk data. <a href=https://github.com/cortexproject/cortex/pull/1913>#1913</a></li><li>[FEATURE] Added readiness probe endpoint<code>/ready</code> to queriers. <a href=https://github.com/cortexproject/cortex/pull/1934>#1934</a></li><li>[FEATURE] Added &ldquo;multi&rdquo; KV store that can interact with two other KV stores, primary one for all reads and writes, and secondary one, which only receives writes. Primary/secondary store can be modified in runtime via runtime-config mechanism (previously &ldquo;overrides&rdquo;). <a href=https://github.com/cortexproject/cortex/pull/1749>#1749</a></li><li>[FEATURE] Added support to store ring tokens to a file and read it back on startup, instead of generating/fetching the tokens to/from the ring. This feature can be enabled with the flag <code>-ingester.tokens-file-path</code>. <a href=https://github.com/cortexproject/cortex/pull/1750>#1750</a></li><li>[FEATURE] Experimental TSDB: Added <code>/series</code> API endpoint support with TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1830>#1830</a></li><li>[FEATURE] Experimental TSDB: Added TSDB blocks <code>compactor</code> component, which iterates over users blocks stored in the bucket and compact them according to the configured block ranges. <a href=https://github.com/cortexproject/cortex/pull/1942>#1942</a></li><li>[ENHANCEMENT] metric <code>cortex_ingester_flush_reasons</code> gets a new <code>reason</code> value: <code>Spread</code>, when <code>-ingester.spread-flushes</code> option is enabled. <a href=https://github.com/cortexproject/cortex/pull/1978>#1978</a></li><li>[ENHANCEMENT] Added <code>password</code> and <code>enable_tls</code> options to redis cache configuration. Enables usage of Microsoft Azure Cache for Redis service. <a href=https://github.com/cortexproject/cortex/pull/1923>#1923</a></li><li>[ENHANCEMENT] Upgraded Kubernetes API version for deployments from <code>extensions/v1beta1</code> to <code>apps/v1</code>. <a href=https://github.com/cortexproject/cortex/pull/1941>#1941</a></li><li>[ENHANCEMENT] Experimental TSDB: Open existing TSDB on startup to prevent ingester from becoming ready before it can accept writes. The max concurrency is set via <code>--experimental.tsdb.max-tsdb-opening-concurrency-on-startup</code>. <a href=https://github.com/cortexproject/cortex/pull/1917>#1917</a></li><li>[ENHANCEMENT] Experimental TSDB: Querier now exports aggregate metrics from Thanos bucket store and in memory index cache (many metrics to list, but all have <code>cortex_querier_bucket_store_</code> or <code>cortex_querier_blocks_index_cache_</code> prefix). <a href=https://github.com/cortexproject/cortex/pull/1996>#1996</a></li><li>[ENHANCEMENT] Experimental TSDB: Improved multi-tenant bucket store. <a href=https://github.com/cortexproject/cortex/pull/1991>#1991</a><ul><li>Allowed to configure the blocks sync interval via <code>-experimental.tsdb.bucket-store.sync-interval</code> (0 disables the sync)</li><li>Limited the number of tenants concurrently synched by <code>-experimental.tsdb.bucket-store.block-sync-concurrency</code></li><li>Renamed <code>cortex_querier_sync_seconds</code> metric to <code>cortex_querier_blocks_sync_seconds</code></li><li>Track <code>cortex_querier_blocks_sync_seconds</code> metric for the initial sync too</li></ul></li><li>[BUGFIX] Fixed unnecessary CAS operations done by the HA tracker when the jitter is enabled. <a href=https://github.com/cortexproject/cortex/pull/1861>#1861</a></li><li>[BUGFIX] Fixed ingesters getting stuck in a LEAVING state after coming up from an ungraceful exit. <a href=https://github.com/cortexproject/cortex/pull/1921>#1921</a></li><li>[BUGFIX] Reduce memory usage when ingester Push() errors. <a href=https://github.com/cortexproject/cortex/pull/1922>#1922</a></li><li>[BUGFIX] Table Manager: Fixed calculation of expected tables and creation of tables from next active schema considering grace period. <a href=https://github.com/cortexproject/cortex/pull/1976>#1976</a></li><li>[BUGFIX] Experimental TSDB: Fixed ingesters consistency during hand-over when using experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1854>#1854</a> <a href=https://github.com/cortexproject/cortex/pull/1818>#1818</a></li><li>[BUGFIX] Experimental TSDB: Fixed metrics when using experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1981>#1981</a> <a href=https://github.com/cortexproject/cortex/pull/1982>#1982</a> <a href=https://github.com/cortexproject/cortex/pull/1990>#1990</a> <a href=https://github.com/cortexproject/cortex/pull/1983>#1983</a></li><li>[BUGFIX] Experimental memberlist: Use the advertised address when sending packets to other peers of the Gossip memberlist. <a href=https://github.com/cortexproject/cortex/pull/1857>#1857</a></li><li>[BUGFIX] Experimental TSDB: Fixed incorrect query results introduced in <a href=https://github.com/cortexproject/cortex/pull/2604>#2604</a> caused by a buffer incorrectly reused while iterating samples. <a href=https://github.com/cortexproject/cortex/pull/2697>#2697</a></li></ul><h3 id=upgrading-postgresql-if-youre-using-configs-service>Upgrading PostgreSQL (if you&rsquo;re using configs service)</h3><p>Reference: <a href=https://github.com/golang-migrate/migrate/tree/master/database/postgres#upgrading-from-v1>https://github.com/golang-migrate/migrate/tree/master/database/postgres#upgrading-from-v1</a></p><ol><li>Install the migrate package cli tool: <a href=https://github.com/golang-migrate/migrate/tree/master/cmd/migrate#installation>https://github.com/golang-migrate/migrate/tree/master/cmd/migrate#installation</a></li><li>Drop the <code>schema_migrations</code> table: <code>DROP TABLE schema_migrations;</code>.</li><li>Run the migrate command:</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>migrate  -path &lt;absolute_path_to_cortex&gt;/cmd/cortex/migrations -database postgres://localhost:5432/database force <span style=color:#0000cf;font-weight:700>2</span>
</code></pre></div><h3 id=known-issues-2>Known issues</h3><ul><li><p>The <code>cortex_prometheus_rule_group_last_evaluation_timestamp_seconds</code> metric, tracked by the ruler, is not unregistered for rule groups not being used anymore. This issue will be fixed in the next Cortex release (see <a href=https://github.com/cortexproject/cortex/issues/2033>2033</a>).</p></li><li><p>Write-Ahead-Log (WAL) does not have automatic repair of corrupt checkpoint or WAL segments, which is possible if ingester crashes abruptly or the underlying disk corrupts. Currently the only way to resolve this is to manually delete the affected checkpoint and/or WAL segments. Automatic repair will be added in the future releases.</p></li></ul><h2 id=040--2019-12-02>0.4.0 / 2019-12-02</h2><ul><li>[CHANGE] The frontend component has been refactored to be easier to re-use. When upgrading the frontend, cache entries will be discarded and re-created with the new protobuf schema. <a href=https://github.com/cortexproject/cortex/pull/1734>#1734</a></li><li>[CHANGE] Removed direct DB/API access from the ruler. <code>-ruler.configs.url</code> has been now deprecated. <a href=https://github.com/cortexproject/cortex/pull/1579>#1579</a></li><li>[CHANGE] Removed <code>Delta</code> encoding. Any old chunks with <code>Delta</code> encoding cannot be read anymore. If <code>ingester.chunk-encoding</code> is set to <code>Delta</code> the ingester will fail to start. <a href=https://github.com/cortexproject/cortex/pull/1706>#1706</a></li><li>[CHANGE] Setting <code>-ingester.max-transfer-retries</code> to 0 now disables hand-over when ingester is shutting down. Previously, zero meant infinite number of attempts. <a href=https://github.com/cortexproject/cortex/pull/1771>#1771</a></li><li>[CHANGE] <code>dynamo</code> has been removed as a valid storage name to make it consistent for all components. <code>aws</code> and <code>aws-dynamo</code> remain as valid storage names.</li><li>[CHANGE/FEATURE] The frontend split and cache intervals can now be configured using the respective flag <code>--querier.split-queries-by-interval</code> and <code>--frontend.cache-split-interval</code>.<ul><li>If <code>--querier.split-queries-by-interval</code> is not provided request splitting is disabled by default.</li><li><strong><code>--querier.split-queries-by-day</code> is still accepted for backward compatibility but has been deprecated. You should now use <code>--querier.split-queries-by-interval</code>. We recommend a to use a multiple of 24 hours.</strong></li></ul></li><li>[FEATURE] Global limit on the max series per user and metric <a href=https://github.com/cortexproject/cortex/pull/1760>#1760</a><ul><li><code>-ingester.max-global-series-per-user</code></li><li><code>-ingester.max-global-series-per-metric</code></li><li>Requires <code>-distributor.replication-factor</code> and <code>-distributor.shard-by-all-labels</code> set for the ingesters too</li></ul></li><li>[FEATURE] Flush chunks with stale markers early with <code>ingester.max-stale-chunk-idle</code>. <a href=https://github.com/cortexproject/cortex/pull/1759>#1759</a></li><li>[FEATURE] EXPERIMENTAL: Added new KV Store backend based on memberlist library. Components can gossip about tokens and ingester states, instead of using Consul or Etcd. <a href=https://github.com/cortexproject/cortex/pull/1721>#1721</a></li><li>[FEATURE] EXPERIMENTAL: Use TSDB in the ingesters & flush blocks to S3/GCS ala Thanos. This will let us use an Object Store more efficiently and reduce costs. <a href=https://github.com/cortexproject/cortex/pull/1695>#1695</a></li><li>[FEATURE] Allow Query Frontend to log slow queries with <code>frontend.log-queries-longer-than</code>. <a href=https://github.com/cortexproject/cortex/pull/1744>#1744</a></li><li>[FEATURE] Add HTTP handler to trigger ingester flush & shutdown - used when running as a stateful set with the WAL enabled. <a href=https://github.com/cortexproject/cortex/pull/1746>#1746</a></li><li>[FEATURE] EXPERIMENTAL: Added GCS support to TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1772>#1772</a></li><li>[ENHANCEMENT] Reduce memory allocations in the write path. <a href=https://github.com/cortexproject/cortex/pull/1706>#1706</a></li><li>[ENHANCEMENT] Consul client now follows recommended practices for blocking queries wrt returned Index value. <a href=https://github.com/cortexproject/cortex/pull/1708>#1708</a></li><li>[ENHANCEMENT] Consul client can optionally rate-limit itself during Watch (used e.g. by ring watchers) and WatchPrefix (used by HA feature) operations. Rate limiting is disabled by default. New flags added: <code>--consul.watch-rate-limit</code>, and <code>--consul.watch-burst-size</code>. <a href=https://github.com/cortexproject/cortex/pull/1708>#1708</a></li><li>[ENHANCEMENT] Added jitter to HA deduping heartbeats, configure using <code>distributor.ha-tracker.update-timeout-jitter-max</code> <a href=https://github.com/cortexproject/cortex/pull/1534>#1534</a></li><li>[ENHANCEMENT] Add ability to flush chunks with stale markers early. <a href=https://github.com/cortexproject/cortex/pull/1759>#1759</a></li><li>[BUGFIX] Stop reporting successful actions as 500 errors in KV store metrics. <a href=https://github.com/cortexproject/cortex/pull/1798>#1798</a></li><li>[BUGFIX] Fix bug where duplicate labels can be returned through metadata APIs. <a href=https://github.com/cortexproject/cortex/pull/1790>#1790</a></li><li>[BUGFIX] Fix reading of old, v3 chunk data. <a href=https://github.com/cortexproject/cortex/pull/1779>#1779</a></li><li>[BUGFIX] Now support IAM roles in service accounts in AWS EKS. <a href=https://github.com/cortexproject/cortex/pull/1803>#1803</a></li><li>[BUGFIX] Fixed duplicated series returned when querying both ingesters and store with the experimental TSDB blocks storage. <a href=https://github.com/cortexproject/cortex/pull/1778>#1778</a></li></ul><p>In this release we updated the following dependencies:</p><ul><li>gRPC v1.25.0 (resulted in a drop of 30% CPU usage when compression is on)</li><li>jaeger-client v2.20.0</li><li>aws-sdk-go to v1.25.22</li></ul><h2 id=030--2019-10-11>0.3.0 / 2019-10-11</h2><p>This release adds support for Redis as an alternative to Memcached, and also includes many optimisations which reduce CPU and memory usage.</p><ul><li>[CHANGE] Gauge metrics were renamed to drop the <code>_total</code> suffix. <a href=https://github.com/cortexproject/cortex/pull/1685>#1685</a><ul><li>In Alertmanager, <code>alertmanager_configs_total</code> is now <code>alertmanager_configs</code></li><li>In Ruler, <code>scheduler_configs_total</code> is now <code>scheduler_configs</code></li><li><code>scheduler_groups_total</code> is now <code>scheduler_groups</code>.</li></ul></li><li>[CHANGE] <code>--alertmanager.configs.auto-slack-root</code> flag was dropped as auto Slack root is not supported anymore. <a href=https://github.com/cortexproject/cortex/pull/1597>#1597</a></li><li>[CHANGE] In table-manager, default DynamoDB capacity was reduced from 3,000 units to 1,000 units. We recommend you do not run with the defaults: find out what figures are needed for your environment and set that via <code>-dynamodb.periodic-table.write-throughput</code> and <code>-dynamodb.chunk-table.write-throughput</code>.</li><li>[FEATURE] Add Redis support for caching <a href=https://github.com/cortexproject/cortex/pull/1612>#1612</a></li><li>[FEATURE] Allow spreading chunk writes across multiple S3 buckets <a href=https://github.com/cortexproject/cortex/pull/1625>#1625</a></li><li>[FEATURE] Added <code>/shutdown</code> endpoint for ingester to shutdown all operations of the ingester. <a href=https://github.com/cortexproject/cortex/pull/1746>#1746</a></li><li>[ENHANCEMENT] Upgraded Prometheus to 2.12.0 and Alertmanager to 0.19.0. <a href=https://github.com/cortexproject/cortex/pull/1597>#1597</a></li><li>[ENHANCEMENT] Cortex is now built with Go 1.13 <a href=https://github.com/cortexproject/cortex/pull/1675>#1675</a>, <a href=https://github.com/cortexproject/cortex/pull/1676>#1676</a>, <a href=https://github.com/cortexproject/cortex/pull/1679>#1679</a></li><li>[ENHANCEMENT] Many optimisations, mostly impacting ingester and querier: <a href=https://github.com/cortexproject/cortex/pull/1574>#1574</a>, <a href=https://github.com/cortexproject/cortex/pull/1624>#1624</a>, <a href=https://github.com/cortexproject/cortex/pull/1638>#1638</a>, <a href=https://github.com/cortexproject/cortex/pull/1644>#1644</a>, <a href=https://github.com/cortexproject/cortex/pull/1649>#1649</a>, <a href=https://github.com/cortexproject/cortex/pull/1654>#1654</a>, <a href=https://github.com/cortexproject/cortex/pull/1702>#1702</a></li></ul><p>Full list of changes: <a href=https://github.com/cortexproject/cortex/compare/v0.2.0...v0.3.0>https://github.com/cortexproject/cortex/compare/v0.2.0...v0.3.0</a></p><h2 id=020--2019-09-05>0.2.0 / 2019-09-05</h2><p>This release has several exciting features, the most notable of them being setting <code>-ingester.spread-flushes</code> to potentially reduce your storage space by upto 50%.</p><ul><li>[CHANGE] Flags changed due to changes upstream in Prometheus Alertmanager <a href=https://github.com/cortexproject/cortex/pull/929>#929</a>:<ul><li><code>alertmanager.mesh.listen-address</code> is now <code>cluster.listen-address</code></li><li><code>alertmanager.mesh.peer.host</code> and <code>alertmanager.mesh.peer.service</code> can be replaced by <code>cluster.peer</code></li><li><code>alertmanager.mesh.hardware-address</code>, <code>alertmanager.mesh.nickname</code>, <code>alertmanager.mesh.password</code>, and <code>alertmanager.mesh.peer.refresh-interval</code> all disappear.</li></ul></li><li>[CHANGE] &ndash;claim-on-rollout flag deprecated; feature is now always on <a href=https://github.com/cortexproject/cortex/pull/1566>#1566</a></li><li>[CHANGE] Retention period must now be a multiple of periodic table duration <a href=https://github.com/cortexproject/cortex/pull/1564>#1564</a></li><li>[CHANGE] The value for the name label for the chunks memcache in all <code>cortex_cache_</code> metrics is now <code>chunksmemcache</code> (before it was <code>memcache</code>) <a href=https://github.com/cortexproject/cortex/pull/1569>#1569</a></li><li>[FEATURE] Makes the ingester flush each timeseries at a specific point in the max-chunk-age cycle with <code>-ingester.spread-flushes</code>. This means multiple replicas of a chunk are very likely to contain the same contents which cuts chunk storage space by up to 66%. <a href=https://github.com/cortexproject/cortex/pull/1578>#1578</a></li><li>[FEATURE] Make minimum number of chunk samples configurable per user <a href=https://github.com/cortexproject/cortex/pull/1620>#1620</a></li><li>[FEATURE] Honor HTTPS for custom S3 URLs <a href=https://github.com/cortexproject/cortex/pull/1603>#1603</a></li><li>[FEATURE] You can now point the query-frontend at a normal Prometheus for parallelisation and caching <a href=https://github.com/cortexproject/cortex/pull/1441>#1441</a></li><li>[FEATURE] You can now specify <code>http_config</code> on alert receivers <a href=https://github.com/cortexproject/cortex/pull/929>#929</a></li><li>[FEATURE] Add option to use jump hashing to load balance requests to memcached <a href=https://github.com/cortexproject/cortex/pull/1554>#1554</a></li><li>[FEATURE] Add status page for HA tracker to distributors <a href=https://github.com/cortexproject/cortex/pull/1546>#1546</a></li><li>[FEATURE] The distributor ring page is now easier to read with alternate rows grayed out <a href=https://github.com/cortexproject/cortex/pull/1621>#1621</a></li></ul><h2 id=010--2019-08-07>0.1.0 / 2019-08-07</h2><ul><li>[CHANGE] HA Tracker flags were renamed to provide more clarity <a href=https://github.com/cortexproject/cortex/pull/1465>#1465</a><ul><li><code>distributor.accept-ha-labels</code> is now <code>distributor.ha-tracker.enable</code></li><li><code>distributor.accept-ha-samples</code> is now <code>distributor.ha-tracker.enable-for-all-users</code></li><li><code>ha-tracker.replica</code> is now <code>distributor.ha-tracker.replica</code></li><li><code>ha-tracker.cluster</code> is now <code>distributor.ha-tracker.cluster</code></li></ul></li><li>[FEATURE] You can specify &ldquo;heap ballast&rdquo; to reduce Go GC Churn <a href=https://github.com/cortexproject/cortex/pull/1489>#1489</a></li><li>[BUGFIX] HA Tracker no longer always makes a request to Consul/Etcd when a request is not from the active replica <a href=https://github.com/cortexproject/cortex/pull/1516>#1516</a></li><li>[BUGFIX] Queries are now correctly cancelled by the query-frontend <a href=https://github.com/cortexproject/cortex/pull/1508>#1508</a></li></ul><div class="text-muted mt-5 pt-3 border-top"></div></div></main></div></div><footer class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5"><div class="col-12 col-sm-4 pb-5 pb-sm-0"><img src=/images/cortex-stacked-white.png width=75px class="img-fluid float-left"></div><div class="col-12 col-sm-4 pb-5 pb-sm-0"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://slack.cncf.io class="text-reset text-white"><i class="fab fa-fw fa-slack"></i>Slack</a></li><li><a href=https://github.com/cortexproject/cortex class="text-reset text-white"><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a href=https://twitter.com/cortexmetrics class="text-reset text-white"><i class="fab fa-fw fa-twitter"></i>Twitter</a></li></ul></div><div class="col-12 col-sm-4"><h6 class=font-weight-bold>About</h6><p>Cortex is an OSS licensed project as Apache License 2.0</p></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.29b0315468c00226fa6f4556a9cebc0ac4fe1ce1457a01b22c0a06b329877383.js integrity="sha256-KbAxVGjAAib6b0VWqc68CsT+HOFFegGyLAoGsymHc4M=" crossorigin=anonymous></script></body></html>